var pivot=function(){"use strict";function a(o){n=[],r=[],i={},e={},t={};s={rowLabels:{},columnLabels:{},summaries:{}};if(o===undefined)o={};if(o.fields!==undefined)j(o.fields);if(o.filters!==undefined)_(o.filters);if(o.rowLabels!==undefined)it(o.rowLabels);if(o.columnLabels!==undefined)st(o.columnLabels);if(o.summaries!==undefined)ot(o.summaries);if(o.csv!==undefined)N(o.csv);if(o.json!==undefined)T(o.json);return pivot}function f(){return a()}function l(e){var n;if(e===undefined)n=F();else if(e===false)n="Pass showFields as true in order to view fields here.";return{fields:n,filters:t,rowLabels:w(s.rowLabels),columnLabels:w(s.columnLabels),summaries:w(s.summaries)}}function c(){return{pad:h,padRight:p,padLeft:d,formatDate:v,formatTime:m,isArray:g,isRegExp:y,shallowClone:b,objectKeys:w,objectType:E,sortNumerically:S}}function h(e,t,n,r){if(r===undefined)r=" ";t=t.toString();r=r.toString();while(t.length<n){if(e==="left")t=r+t;else t=t+r}return t}function p(e,t,n){return h("right",e,t,n)}function d(e,t,n){return h("left",e,t,n)}function v(e){return e.getUTCFullYear()+"-"+d(e.getUTCMonth()+1,2,"0")+"-"+d(e.getUTCDate(),2,"0")}function m(e){return v(e)+" "+d(e.getUTCHours(),2,"0")+":"+d(e.getUTCMinutes(),2,"0")}function g(e){if(!Array.isArray)return E(e)=="array";else return Array.isArray(e)}function y(e){return E(e)=="regexp"}function b(e){var t={};for(var n in e){if(e.hasOwnProperty(n))t[n]=e[n]}return t}function w(e){if(Object.keys)return Object.keys(e);var t=[];for(key in e){t.push(key)}return t}function E(e){return{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()}function S(e){return e.sort(function(e,t){return e-t})}function x(t){var n=[];var r={},i=-1,s=t.length;while(++i<s){var o=e[t[i]];if(o===undefined)o=V(t[i]);n.push(o)}return n}function T(e){var t,r=q("pseudo");if(E(e)==="string")e=JSON.parse(e);n=[];var i={},s=-1,o=e.length;while(++s<o){if(s===0)t=x(e[s]);else n.push(k(e[s],t,r))}}function N(e){var t,r=q("pseudo");n=C(e,function(e,n){if(n===0)t=x(e);else return k(e,t,r)})}function C(e,t){function f(){if(s.lastIndex>=e.length)return r;if(a){a=false;return n}var t=s.lastIndex;if(e.charCodeAt(t)===34){var i=t;while(i++<e.length){if(e.charCodeAt(i)===34){if(e.charCodeAt(i+1)!==34)break;i++}}s.lastIndex=i+2;var o=e.charCodeAt(i+1);if(o===13){a=true;if(e.charCodeAt(i+2)===10)s.lastIndex++}else if(o===10){a=true}return e.substring(t+1,i).replace(/""/g,'"')}var u=s.exec(e);if(u){a=u[0].charCodeAt(0)!==44;return e.substring(t,u.index)}s.lastIndex=e.length;return e.substring(t)}var n={},r={},i=[],s=/\r\n|[,\r\n]/g,o=0,u,a;s.lastIndex=0;while((u=f())!==r){var l=[];while(u!==n&&u!==r){l.push(u);u=f()}if(t&&!(l=t(l,o++)))continue;i.push(l)}return i}function k(e,t,n){var r={},i=-1,s=t.length;while(++i<s){var o=K(t[i].name,e[i]);r[t[i].name]=o;$(t[i].name,o)}i=-1,s=n.length;while(++i<s){var u=n[i],o=K(u.name,u.pseudoFunction(r,u));r[u.name]=o;$(u.name,o)}return r}function L(e){var t={all:M,set:_,apply:D,add:O};if(e!==undefined){return t[e]}else{return t}}function A(e){if(e===undefined)e=t;var n;for(n in e){if(e.hasOwnProperty(n))if(y(e[n])){}else if(g(e[n])){var r=-1,i=e[n].length;while(++r<i){e[n][r]=K(n,e[n][r])}}else{e[n]=K(n,e[n])}}}function O(e){for(var n in e){if(e.hasOwnProperty(n))t[n]=e[n]}A()}function M(){return t}function _(e){t=e;at();A()}function D(e){var s=r,o=[];if(e!==undefined)_(e);var u=H();if(u){s=r}else{s=n}var a=s.length,f=w(t).length,l=-1;while(++l<a){var c=s[l],h=0;for(var p in t){if(t.hasOwnProperty(p)&&c.hasOwnProperty(p)&&P(t[p],c[p]))h+=1}if(h===f){o.push(c)}}r=o;i=b(t);at();return r}function P(e,t){if(g(e)){var n=-1,r=e.length;while(++n<r){if(e[n]===t)return true}}else if(y(e)){return e.test(t)}else{return t===e}return false}function H(){var e=0,n=w(i).length;for(var r in i){if(i.hasOwnProperty(r)&&i.hasOwnProperty(r)&&t[r]===i[r])e+=1}return n>0&&e>=n}function B(e){var t={columnLabelable:q("columnLabelable"),rowLabelable:q("rowLabelable"),summarizable:q("summarizable"),filterable:q("filterable"),pseudo:q("pseudo"),clone:F,add:V,all:I,set:j,get:R};if(e!==undefined){return t[e]}else{return t}}function j(t){e={};var n=-1,r=t.length;while(++n<r){V(t[n])}}function F(){var t=[];for(var n in e){var r={};for(var i in e[n]){if(e[n].hasOwnProperty(i)&&i!=="values")r[i]=e[n][i]}t.push(r)}return t}function I(){var t=[];for(var n in e){if(e.hasOwnProperty(n))t[e[n].index]=e[n]}return t}function q(t){var n=[];for(var r in e){if(e.hasOwnProperty(r)&&e[r][t]===true)n.push(e[r])}return n}function R(t){return e[t]}function U(e,t){var n=0,r=-1,i=e.length;while(++r<i){n+=e[r][t.dataSource]}return n}function z(e,t){return U(e,t)/e.length}function W(e,t){return"none"}function X(e,t){return e.length}function V(t){if(E(t)==="string")t={name:t};if(t.type===undefined)t.type="string";if(t.pseudo===undefined)t.pseudo=false;if(t.rowLabelable===undefined)t.rowLabelable=true;if(t.columnLabelable===undefined)t.columnLabelable=false;if(t.filterable===undefined)t.filterable=false;if(t.dataSource===undefined)t.dataSource=t.name;if(t.summarizable&&(t.rowLabelable||t.columnLabelable||t.filterable)){var n=b(t);n.rowLabelable=false;n.filterable=false;n.dataSource=t.name;if(n.summarizable!==true)n.name=n.name+"_"+n.summarizable;else n.name=n.name+"_count";V(n);t.summarizable=false;t.summarizeFunction=undefined}else if(t.summarizable){if(t.summarizeFunction===undefined){switch(t.summarizable){case"sum":t.summarizeFunction=U;break;case"avg":t.summarizeFunction=z;break;case"none":t.summarizeFunction=W;break;default:t.summarizeFunction=X;break}t.summarizable=true}}else{t.summarizable=false}if(t.pseudo&&t.pseudoFunction===undefined)t.pseudoFunction=function(e){return""};if(t.displayFunction===undefined)t.displayFunction=J;t.values={};t.displayValues={};t.index=w(e).length;e[t.name]=t;return t}function $(t,n){if(e[t]===undefined||e[t].filterable===false)return;if(e[t].values[n]===undefined){e[t].values[n]={count:1,displayValue:e[t].displayFunction(n,t)}}else{e[t].values[n].count+=1}}function J(t,n){var r;if(E(n)==="string")r=e[n];if(r===undefined)r=V(n);switch(r.type){case"cents":return"$"+(t/100).toFixed(2);case"currency":return"$"+t.toFixed(2);case"date":return v(new Date(t));case"time":return m(new Date(t));default:return t}}function K(t,n){var r,i;if(E(t)==="string")r=e[t];if(r===undefined)r=V(t);switch(r.type){case"integer":case"cents":if(E(n)==="number")return n;else return parseInt(n,10);case"float":case"currency":if(E(n)==="number")return n;else return parseFloat(n,10);case"date":case"time":switch(E(n)){case"number":case"date":return n;default:if(/^\d+$/.test(n))return parseInt(n);else return Date.parse(n)};default:return n.toString()}}function Q(e){var t={raw:n,all:r};if(e!==undefined){return t[e]}else{return t}}function G(){return{all:Y,rowLabels:Z,columnLabels:et,summaries:tt}}function Y(){return s}function Z(){return{set:it,get:s.rowLabels}}function et(){return{set:st,get:s.columnLabels}}function tt(){return{set:ot,get:s.summaries}}function nt(t,n){if(E(n)==="string")n=e[n];at();s[t][n.name]=n}function rt(e,t){s[e]={};at();var n=-1,r=t.length;while(++n<r){nt(e,t[n])}}function it(e){rt("rowLabels",e)}function st(e){rt("columnLabels",e)}function ot(e){rt("summaries",e)}function ut(){return{all:ft,columns:mt}}function at(){o=undefined;u=undefined}function ft(){if(o!==undefined&&u!==undefined)return vt();D();o={};u=[];lt();if(w(s.columnLabels).length>0)ct();else{gt();pt()}return vt()}function lt(){var t=-1,n=r.length,i;while(++t<n){var a=r[t],f="";for(var l in s.rowLabels){if(s.rowLabels.hasOwnProperty(l)){if(t===0)u.push({fieldName:l,width:1,type:"row"});f+=l+":"+a[l]+"|"}}if(o[f]===undefined){o[f]={};for(var l in s.rowLabels){if(s.rowLabels.hasOwnProperty(l))o[f][l]=e[l].displayFunction(a[l],l)}o[f].rows=[]}o[f].rows.push(a)}}function ct(){for(var t in s.columnLabels){if(s.columnLabels.hasOwnProperty(t)){var n={};for(var r in o){var i=ht(o[r].rows,e[t]);for(var u in i){if(n[u]===undefined)n[u]=1;else n[u]+=1;o[r][u]=dt(i[u])}}yt(t,n)}}return o}function ht(e,t){var n=-1,r=e.length,i={};while(++n<r){var s=e[n][t.name];if(i[s]===undefined)i[s]={rows:[]};i[s].rows.push(e[n])}return i}function pt(){for(var e in o){dt(o[e])}return o}function dt(t){var n={};for(var r in s.summaries){if(s.summaries.hasOwnProperty(r)){t[r]=e[r].summarizeFunction(t.rows,e[r]);t[r]=e[r].displayFunction(t[r],r)}}return t}function vt(){var e=[],t=w(o).sort(),n=-1,r=t.length;while(++n<r){e.push(o[t[n]])}return e}function mt(){if(o===undefined||u===undefined)ft();return u}function gt(){for(var e in s.summaries){if(s.summaries.hasOwnProperty(e))u.push({fieldName:e,width:1,type:"summary"})}return u}function yt(t,n){var r=w(n).sort(e[t].sortFunction),i=-1,o=r.length,a=w(s.summaries).length;while(++i<o){u.push({fieldName:r[i],width:a,type:"column"})}return u}var e,t,n,r,i,s,o,u;a();return{init:a,reset:f,config:l,utils:c,csv:N,json:T,data:Q,results:ut,fields:B,filters:L,display:G}}()