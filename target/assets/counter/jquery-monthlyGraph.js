Raphael.fn.drawGrid=function(e,t,n,r,i,s,o){o=o||"#000";var u=["M",Math.round(e)+.5,Math.round(t)+.5,"L",Math.round(e+n)+.5,Math.round(t)+.5,Math.round(e+n)+.5,Math.round(t+r)+.5,Math.round(e)+.5,Math.round(t+r)+.5,Math.round(e)+.5,Math.round(t)+.5],a=r/s,f=n/i;for(var l=1;l<s;l++){u=u.concat(["M",Math.round(e)+.5,Math.round(t+l*a)+.5,"H",Math.round(e+n)+.5])}for(l=1;l<i;l++){u=u.concat(["M",Math.round(e+l*f)+.5,Math.round(t)+.5,"V",Math.round(t+r)+.5])}return this.path(u.join(",")).attr({stroke:o})};(function(e){e.monthlyGraph=function(t,n){var i={dataSource:"direct",data:{labels:["Mo","Di","Mi","Do","Fr","Sa","So"],data:[5,18,26,23,21,4,0]},ajaxParams:{},labelX:function(e){return e+". September 2011"},labelY:function(e){return e+" Zugriffe"},labelY1:function(){return"1 Zugriff"},onComplete:function(){},gridColor:"#ff860d",width:800,height:250};var s=this;s.settings={};var o=e(t);var u={};s.init=function(){s.settings=e.extend({},i,n);u={labels:[],data:[]};a()};s.redraw=function(){a()};var a=function(){if(s.settings.dataSource=="table"){e("#"+s.settings.tableId+" tfoot th").each(function(){u.labels.push(e(this).html())});e("#"+s.settings.tableId+" tbody td").each(function(){u.data.push(e(this).html())});f()}if(s.settings.dataSource=="direct"){u=s.settings.data;f()}if(s.settings.dataSource=="callback"){u=s.settings.data();f()}if(s.settings.dataSource=="ajax"){e.getJSON(s.settings.data,s.settings.ajaxParams,function(e){u=e;f()})}};var f=function(){o.empty();var e=s.settings.labelX;var n=s.settings.labelY;var i=s.settings.labelY1;var a=s.settings.width,f=s.settings.height,c=0,h=20,p=20,d="#FFC20F";r=Raphael(t,a,f);txt={font:"12px Helvetica, Arial",fill:"#fff"};txtLabel={font:"12px Helvetica, Arial",fill:"#648834"};txt1={font:"10px Helvetica, Arial",fill:"#fff"};txt2={font:"12px Helvetica, Arial",fill:"#000"};X=(a-c)/u.labels.length;var v=Math.max.apply(Math,u.data);if(v==0)v=10;var m=(f-h-p)/v;r.drawGrid(c+X*.5+.5,p+.5,a-c-X,f-p-h,10,10,s.settings.gridColor);var g=r.path().attr({stroke:d,"stroke-width":4,"stroke-linejoin":"round"}),y=r.path().attr({stroke:"none",opacity:.3,fill:d}),b=r.set(),w=0,E=0,S=false,x,T=r.set();b.push(r.text(60,12,"24 hits").attr(txt));b.push(r.text(60,27,"22 September 2008").attr(txt1));b.hide();var N=r.popup(100,100,b,"right").attr({fill:"#000",stroke:"#4d883e","stroke-width":2,"fill-opacity":.7}).hide();var C,k;for(var L=0,A=u.labels.length;L<A;L++){var O=Math.round(f-h-m*u.data[L]),M=Math.round(c+X*(L+.5)),_=r.text(M,f-6,u.labels[L]).attr(txtLabel).toBack();if(!L){C=["M",M,O,"C",M,O];k=["M",c+X*.5,f-h,"L",M,O,"C",M,O]}if(L&&L<A-1){var D=Math.round(f-h-m*u.data[L-1]),P=Math.round(c+X*(L-.5)),H=Math.round(f-h-m*u.data[L+1]),B=Math.round(c+X*(L+1.5));var j=l(P,D,M,O,B,H);C=C.concat([j.x1,j.y1,M,O,j.x2,j.y2]);k=k.concat([j.x1,j.y1,M,O,j.x2,j.y2])}var F=r.circle(M,O,4).attr({fill:"#ff860d",stroke:d,"stroke-width":4});T.push(r.rect(c+X*L,0,X,f-h).attr({stroke:"none",fill:"#fff",opacity:0}));var I=T[T.length-1];(function(t,s,o,u,f){var l,c=0;I.hover(function(){clearTimeout(x);var l="right";if(t+N.getBBox().width>a){l="left"}var c=r.popup(t,s,b,l,1),h=Raphael.animation({path:c.path,transform:["t",c.dx,c.dy]},200*S);w=b[0].transform()[0][1]+c.dx;E=b[0].transform()[0][2]+c.dy;N.show().stop().animate(h);b[0].attr({text:o==1?i():n(o)}).show().stop().animateWith(N,h,{transform:["t",w,E]},200*S);b[1].attr({text:e(u)}).show().stop().animateWith(N,h,{transform:["t",w,E]},200*S);f.attr("r",6);S=true},function(){f.attr("r",4);x=setTimeout(function(){N.hide();b[0].hide();b[1].hide();S=false},1)})})(M,O,u.data[L],u.labels[L],F)}C=C.concat([M,O,M,O]);k=k.concat([M,O,M,O,"L",M,f-h,"z"]);g.attr({path:C});y.attr({path:k});N.toFront();b[0].toFront();b[1].toFront();T.toFront();s.settings.onComplete()};var l=function(e,t,n,r,i,s){var o=(n-e)/2,u=(i-n)/2,a=Math.atan((n-e)/Math.abs(r-t)),f=Math.atan((i-n)/Math.abs(r-s));a=t<r?Math.PI-a:a;f=s<r?Math.PI-f:f;var l=Math.PI/2-(a+f)%(Math.PI*2)/2,c=o*Math.sin(l+a),h=o*Math.cos(l+a),p=u*Math.sin(l+f),d=u*Math.cos(l+f);return{x1:n-c,y1:r+h,x2:n+p,y2:r+d}};s.init()};e.fn.monthlyGraph=function(t){return this.each(function(){if(undefined==e(this).data("monthlyGraph")){var n=new e.monthlyGraph(this,t);e(this).data("monthlyGraph",n)}})}})(jQuery)