!(new function(window,document,undefined,$){"use strict";var MODULE;(function(e){var t;(function(e){e.NAME="pjax";e.NAMESPACE=jQuery})(t=e.DEF||(e.DEF={}))})(MODULE||(MODULE={}));var MODULE;(function(e){(function(e){e[e["blank"]=0]="blank";e[e["initiate"]=1]="initiate";e[e["open"]=2]="open";e[e["pause"]=3]="pause";e[e["lock"]=4]="lock";e[e["seal"]=5]="seal";e[e["error"]=6]="error";e[e["crash"]=7]="crash";e[e["terminate"]=8]="terminate";e[e["close"]=9]="close"})(e.State||(e.State={}));var t=e.State;e.EVENT={PJAX:e.DEF.NAME.toLowerCase(),CLICK:"click",SUBMIT:"submit",POPSTATE:"popstate",SCROLL:"scroll"}})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){var t;(function(e){})(t=e.APP||(e.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){var t;(function(e){var t;(function(e){})(t=e.DATA||(e.DATA={}))})(t=e.APP||(e.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){function t(e,t){var n=e.prototype;t=t.reverse();for(var r=t.length;r--;){var i=t[r].prototype;for(var s in i){if("constructor"===s||!n[s]||!i.hasOwnProperty(s)){continue}n[s]=i[s]}}}function n(){function e(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16).toUpperCase()}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e)}function r(e,t){if(!Object.freeze||e===e["window"]||"ownerDocument"in e){return e}!Object.isFrozen(e)&&Object.freeze(e);if(!t){return e}for(var n in e){var i=e[n];if(~"object,function".indexOf(typeof i)&&i){r(i,t)}}return e}function i(e,t){if(!Object.seal||e===e["window"]||"ownerDocument"in e){return e}!Object.isSealed(e)&&Object.seal(e);if(!t){return e}for(var n in e){var r=e[n];if(~"object,function".indexOf(typeof r)&&r){i(r,t)}}return e}e.MIXIN=t;e.UUID=n;e.FREEZE=r;e.SEAL=i})(MODULE||(MODULE={}));var MODULE;(function(e){})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(t){var n=function(){function t(t){this.NAME=e.DEF.NAME;this.NAMESPACE=e.DEF.NAMESPACE;this.UUID=e.UUID();this.state_=e.State.blank;this.state_=t}t.prototype.MAIN=function(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}return this.main_.apply(this,[e].concat(t))};t.prototype.main_=function(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}return e};return t}();t.Template=n})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(t){var n=function(){function t(t){this.UUID=e.UUID();this.state_=e.State.blank;this.state_=t}return t}();t.Template=n})(t=e.VIEW||(e.VIEW={}))})(MODULE||(MODULE={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};var MODULE;(function(e){var t;(function(t){var n=function(t){function n(n,r,i,s){var o=this;t.call(this,e.State.initiate);this.model_=n;this.controller_=r;this.context_=i;this.handlers={click:function(){var e=[];for(var t=0;t<arguments.length;t++){e[t-0]=arguments[t]}o.controller_.click(e)},submit:function(){var e=[];for(var t=0;t<arguments.length;t++){e[t-0]=arguments[t]}o.controller_.submit(e)},popstate:function(){var e=[];for(var t=0;t<arguments.length;t++){e[t-0]=arguments[t]}o.controller_.popstate(e)},scroll:function(){var e=[];for(var t=0;t<arguments.length;t++){e[t-0]=arguments[t]}o.controller_.scroll(e)}};e.FREEZE(this);this.observe_(s)}__extends(n,t);n.prototype.observe_=function(e){this.release_(e);e.link&&this.context_.delegate(e.link,e.nss.event.click,this.handlers.click);e.form&&this.context_.delegate(e.form,e.nss.event.submit,this.handlers.submit);jQuery(window).bind(e.nss.event.popstate,this.handlers.popstate);e.database.active&&e.fix.scroll&&jQuery(window).bind(e.nss.event.scroll,this.handlers.scroll);return this};n.prototype.release_=function(e){e.link&&this.context_.undelegate(e.link,e.nss.event.click);e.form&&this.context_.undelegate(e.form,e.nss.event.submit);jQuery(window).unbind(e.nss.event.popstate);e.database.active&&e.fix.scroll&&jQuery(window).unbind(e.nss.event.scroll);return this};return n}(t.Template);t.Main=n})(t=e.VIEW||(e.VIEW={}))})(MODULE||(MODULE={}));var MODULE;(function(e){e.View=e.VIEW.Main})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(t){var n=function(){function t(){e.FREEZE(this)}t.prototype.enable=function(){e.Model.singleton().enable();return this};t.prototype.disable=function(){e.Model.singleton().disable();return this};t.prototype.click=function(t,n){var r;switch(typeof t){case"undefined":r=jQuery(this).filter("a").first().clone();break;case"object":r=jQuery(t).clone();break;case"string":n=jQuery.extend(true,{},n,{href:t});r=jQuery("<a/>",n);break;default:return this}var i=e.Model.singleton().configure(r[0]);i&&r.first().one(i.nss.event.click,function(){var t=[];for(var n=0;n<arguments.length;n++){t[n-0]=arguments[n]}return e.Controller.singleton().click(t)}).click();return this};t.prototype.submit=function(t,n,r){var i,s=document.createDocumentFragment(),o,u;switch(typeof t){case"undefined":i=jQuery(this).filter("form").first().clone();break;case"object":i=jQuery(t).clone();break;case"string":n=jQuery.extend(true,{},n,{action:t});o=r instanceof Array&&Array||r instanceof Object&&Object||undefined;for(var a in r){switch(o){case Object:if(!Object.prototype.hasOwnProperty.call(r,a)){continue}u=jQuery("<textarea/>",{name:a}).val(r[a]);break;case Array:r[a].attrs=r[a].attrs||{};r[a].attrs.name=r[a].name||r[a].attrs.name;r[a].attrs.type=r[a].type||r[a].attrs.type;u=jQuery("<"+r[a].tag+"/>",r[a].attrs).val(r[a].value);break;default:continue}s.appendChild(u[0])}i=jQuery("<form/>",n).append(s);break;default:return this}var f=e.Model.singleton().configure(i[0]);f&&i.first().one(f.nss.event.submit,function(){var t=[];for(var n=0;n<arguments.length;n++){t[n-0]=arguments[n]}return e.Controller.singleton().submit(t)}).submit();return this};t.prototype.getCache=function(t){if(t===void 0){t=window.location.href}var n=e.Model.singleton().getCache(t);if(n){n={data:n.data,textStatus:n.textStatus,jqXHR:n.jqXHR,expires:n.expires}}return n};t.prototype.setCache=function(t,n,r,i){if(t===void 0){t=window.location.href}switch(arguments.length){case 0:return this.setCache(t,document.documentElement.outerHTML);case 1:return this.setCache(t,null);case 2:case 3:case 4:default:e.Model.singleton().setCache(t,n,r,i)}return this};t.prototype.removeCache=function(t){if(t===void 0){t=window.location.href}e.Model.singleton().removeCache(t);return this};t.prototype.clearCache=function(){e.Model.singleton().clearCache();return this};t.prototype.follow=function(t,n,r,i){if(!e.Model.singleton().isDeferrable){return false}var s=t.currentTarget;n.follow=true;n.host=r||"";if(isFinite(t.timeStamp)){n.timeStamp=i||t.timeStamp}e.Model.singleton().setPageXHR(n);jQuery.when(n).done(function(){!e.Model.singleton().getCache(s.href)&&e.Model.singleton().isOperatable(t)&&e.Model.singleton().setCache(s.href,undefined,undefined,n)});jQuery[e.DEF.NAME].click(s.href);return true};t.prototype.bypass=function(){return e.Model.singleton().bypass()};t.prototype.host=function(){return e.Model.singleton().host()};return t}();t.Functions=n})(t=e.CONTROLLER||(e.CONTROLLER={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(t){var n=function(){function t(){e.FREEZE(this)}return t}();t.Methods=n})(t=e.CONTROLLER||(e.CONTROLLER={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(t){var n=function(){function t(t,n){this.UUID=e.UUID();this.state_=e.State.blank;this.PROPERTIES=[];this.state_=n}t.prototype.EXTEND=function(t){if(t instanceof e.DEF.NAMESPACE){if(t instanceof jQuery){t=t.add()}this.REGISTER_FUNCTION(t);this.REGISTER_METHOD(t)}else{if(t!==this.EXTENSION){t=this.EXTENSION}this.REGISTER_FUNCTION(t)}this.UPDATE_PROPERTIES(t);return t};t.prototype.REGISTER=function(t){var n=this;this.EXTENSION=this.EXTENSION||function(){var e=[];for(var r=0;r<arguments.length;r++){e[r-0]=arguments[r]}var i=n.EXTEND(this);e=[i].concat(e);e=n.EXEC.apply(n,e);return e instanceof Array?t.MAIN.apply(t,e):e};this.EXTEND(this.EXTENSION);window[e.DEF.NAMESPACE]=window[e.DEF.NAMESPACE]||{};if(e.DEF.NAMESPACE.prototype){e.DEF.NAMESPACE[e.DEF.NAME]=e.DEF.NAMESPACE.prototype[e.DEF.NAME]=this.EXTENSION}else{e.DEF.NAMESPACE[e.DEF.NAME]=this.EXTENSION}};t.prototype.EXEC=function(){return this.exec_.apply(this,arguments)};t.prototype.exec_=function(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}return[e].concat(t)};t.prototype.REGISTER_FUNCTION=function(e){var t=this.FUNCTIONS;for(var n in t){if("constructor"===n){continue}e[n]=t[n]}return e};t.prototype.REGISTER_METHOD=function(e){var t=this.METHODS;for(var n in t){if("constructor"===n){continue}e[n]=t[n]}return e};t.prototype.UPDATE_PROPERTIES=function(e){var t=this.PROPERTIES;var n,r,i;for(n=0,r=t.length;n<r;n++){if("constructor"===n){continue}i=t[n];if(e[i]){e[i]=e[i]()}}return e};return t}();t.Template=n})(t=e.CONTROLLER||(e.CONTROLLER={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(t){var n=function(n){function r(r){n.call(this,r,e.State.initiate);this.model_=r;this.FUNCTIONS=new t.Functions;this.METHODS=new t.Methods;this.REGISTER(r);e.FREEZE(this)}__extends(r,n);r.prototype.exec_=function(e){var t=[].slice.call(arguments,1,2),n=t[0];switch(typeof n){case"undefined":case"object":break;default:return e}return[e].concat(t)};r.prototype.view=function(t,n){return new e.View(this.model_,this,t,n)};r.prototype.click=function(e){this.model_.click.apply(this.model_,e)};r.prototype.submit=function(e){this.model_.submit.apply(this.model_,e)};r.prototype.popstate=function(e){this.model_.popstate.apply(this.model_,e)};r.prototype.scroll=function(e){this.model_.scroll.apply(this.model_,e)};return r}(t.Template);t.Main=n;var r=function(){function t(r){if(r===void 0){r=e.Model.singleton()}t.instance_=t.instance_||new n(r)}t.singleton=function(){return t.instance_};t.prototype.singleton=function(){return t.singleton()};return t}();t.Singleton=r})(t=e.CONTROLLER||(e.CONTROLLER={}))})(MODULE||(MODULE={}));var MODULE;(function(e){e.Controller=e.CONTROLLER.Singleton})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){var t=function(){function e(e,t){if(e===void 0){e=1}if(t===void 0){t=0}this.list_=[];this.config_={mode:1,size:0};this.table_={};this.option_={};this.config_.mode=e||this.config_.mode;this.config_.size=t||this.config_.size}e.prototype.define=function(e,t,n){if(t===void 0){t=this.config_.mode}if(n===void 0){n=this.config_.size}this.option_[e]={mode:t,size:n};this.table_[e]=[]};e.prototype.reserve=function(e,t){switch(typeof e){case"string":!this.option_[e]&&this.define(e);var n=this.option_[e],r=this.table_[e],i=[].slice.call(arguments,2);break;case"function":t=e;e=undefined;var n=this.config_,r=this.list_,i=[].slice.call(arguments,1);break;default:return}if("function"!==typeof t){return}var s;if(n.mode>0){s="push"}else{s="unshift"}r[s]([t,i.shift(),i])};e.prototype.digest=function(e,t){switch(typeof e){case"string":!this.option_[e]&&this.define(e);t=t||0;var n=this.option_[e],r=this.table_[e];if(!r){return}break;case"number":case"undefined":t=e||0;e=undefined;var n=this.config_,r=this.list_;break;default:return}if(r.length>n.size&&n.size){if(n.mode>0){r.splice(0,r.length-n.size)}else{r.splice(r.length-n.size,r.length)}}var i;t=t||-1;while(i=t--&&r.pop()){i.shift().apply(i.shift()||window,i.shift()||[])}if(undefined===e){var s=this.table_;for(var o in s){this.digest(o,t)}}};e.prototype.clear=function(e){switch(typeof e){case"string":!this.option_[e]&&this.define(e);this.table_[e].splice(0,this.table_[e].length);break;default:var t=this.table_;for(var n in t){this.clear(n)}}};return e}();e.Task=t})(t=e.LIBRARY||(e.LIBRARY={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){var t;(function(e){var t;(function(e){var t;(function(e){var t;(function(e){var t=function(){function e(e){this.task_=e;this.labels_={done:"done",fail:"fail",always:"always"}}e.prototype.done=function(e){this.task_.reserve(this.labels_.done,e);return this};e.prototype.fail=function(e){this.task_.reserve(this.labels_.fail,e);return this};e.prototype.always=function(e){this.task_.reserve(this.labels_.always,e);return this};e.prototype.resolve=function(){this.task_.clear(this.labels_.fail);this.task_.digest(this.labels_.done);this.task_.digest(this.labels_.always);return this};e.prototype.reject=function(){this.task_.clear(this.labels_.done);this.task_.digest(this.labels_.fail);this.task_.digest(this.labels_.always);return this};return e}();e.Task=t;var n=function(e){function t(){e.apply(this,arguments)}__extends(t,e);return t}(t);e.TaskUp=n;var r=function(e){function t(){e.apply(this,arguments)}__extends(t,e);t.prototype.done=function(e){return this};t.prototype.fail=function(e){return this};t.prototype.always=function(e){return this};t.prototype.resolve=function(){return this};return t}(t);e.TaskDown=r})(t=e.STATEFUL||(e.STATEFUL={}))})(t=e.DB||(e.DB={}))})(t=e.DATA||(e.DATA={}))})(t=e.APP||(e.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(t){var n;(function(t){var n;(function(t){var n;(function(t){var n=function(){function n(t,n,r){var i=this;this.origin_=t;this.connect_=n;this.extend_=r;this.state_=function(){return i.origin_.state()};this.task_=new e.LIBRARY.Task;this.cache_={stateful:{}}}n.prototype.stateful_=function(){var n=this;var r=function(e,t){return n.cache_.stateful[n.state_()]=n.cache_.stateful[n.state_()]||new e(n.origin_,n.connect_,n.extend_,n.task_,t)};switch(this.state_()){case e.State.blank:return r(t.STATE.Blank,true);case e.State.initiate:return r(t.STATE.Initiate,true);case e.State.open:return r(t.STATE.Open,true);case e.State.close:return r(t.STATE.Close,true);case e.State.terminate:return r(t.STATE.Terminate,true);case e.State.error:return r(t.STATE.Error,false);default:return r(t.STATE.Except,false)}};n.prototype.open=function(){return this.stateful_().open()};n.prototype.resolve=function(){return this.stateful_().resolve()};n.prototype.reject=function(){return this.stateful_().reject()};return n}();t.Stateful=n})(n=t.DB||(t.DB={}))})(n=t.DATA||(t.DATA={}))})(n=t.APP||(t.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){var t;(function(e){var t;(function(e){var t;(function(e){var t;(function(t){var n=function(){function t(t,n,r,i,s){this.origin=t;this.connect=n;this.extend=r;this.task=s?new e.STATEFUL.TaskUp(i):new e.STATEFUL.TaskDown(i)}t.prototype.open=function(){return this.task};t.prototype.resolve=function(){};t.prototype.reject=function(){this.task.reject()};return t}();t.Default=n;var r=function(e){function t(){e.apply(this,arguments)}__extends(t,e);t.prototype.open=function(){this.connect();return this.task};t.prototype.resolve=function(){this.open()};t.prototype.reject=function(){this.task.reject()};return t}(n);t.Blank=r;var i=function(e){function t(){e.apply(this,arguments)}__extends(t,e);t.prototype.open=function(){return this.task};t.prototype.resolve=function(){};t.prototype.reject=function(){this.task.reject()};return t}(n);t.Initiate=i;var s=function(e){function t(){e.apply(this,arguments)}__extends(t,e);t.prototype.open=function(){var e=this;this.extend();setTimeout(function(){return e.origin.resolve()},1);return this.task};t.prototype.resolve=function(){this.task.resolve()};t.prototype.reject=function(){this.task.reject()};return t}(n);t.Open=s;var o=function(e){function t(){e.apply(this,arguments)}__extends(t,e);t.prototype.open=function(){this.connect();return this.task};t.prototype.resolve=function(){this.open()};t.prototype.reject=function(){this.task.reject()};return t}(n);t.Close=o;var u=function(e){function t(){e.apply(this,arguments)}__extends(t,e);return t}(n);t.Terminate=u;var a=function(e){function t(){e.apply(this,arguments)}__extends(t,e);return t}(n);t.Error=a;var f=function(e){function t(){e.apply(this,arguments)}__extends(t,e);return t}(n);t.Except=f})(t=e.STATE||(e.STATE={}))})(t=e.DB||(e.DB={}))})(t=e.DATA||(e.DATA={}))})(t=e.APP||(e.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){var t;(function(e){var t;(function(e){var t=function(){function e(e){this.DB=e;this.autoIncrement=false;this.indexes=[];this.size=100;this.buffer={};this.diff={}}e.prototype.accessStore=function(e,t){var n=this;if(t===void 0){t="readwrite"}try{var r=this.DB.database(),i=r&&r.transaction(this.name,t).objectStore(this.name)}catch(s){}if(i){e(i)}else{this.DB.open().done(function(){return n.accessStore(e)})}};e.prototype.accessCount=function(){var e="string"===typeof arguments[0]&&arguments[0],t=arguments[e?1:0];this.accessStore(function(n){var r=e?n.index(e).count():n.count();r.onsuccess=function(){t.apply(this,[].slice.call(arguments,1).concat(this.result))}})};e.prototype.accessRecord=function(e,t,n){this.accessStore(function(n){n.get(e).onsuccess=t},n)};e.prototype.accessCursor=function(e,t,n,r){this.accessStore(function(i){var s;if(n&&t){s=i.index(e).openCursor(t,n)}else if(t){s=i.index(e).openCursor(t)}else{s=i.openCursor()}s.onsuccess=r})};e.prototype.accessAll=function(e,t,n,r){if("function"===typeof e){r=e;e=null;t=null;n=null}this.accessCursor(e,t,n,r)};e.prototype.get=function(e,t){var n=this;this.accessRecord(e,function(e){n.setBuffer(e.target.result);t(e)})};e.prototype.set=function(e,t){var n=this;e=jQuery.extend(true,{},e);this.setBuffer(e,t);this.accessRecord(e[this.keyPath],function(r){r.target.source.put(t?jQuery.extend(true,{},r.target.result,e):e);if(!n.autoIncrement){delete n.diff[e[n.keyPath]]}})};e.prototype.remove=function(e){this.removeBuffer(e);this.accessStore(function(t){t["delete"](e)})};e.prototype.clear=function(){this.clearBuffer();this.accessStore(function(e){e.clear()})};e.prototype.clean=function(){var e=this;if(!this.size||!this.indexes.length){return}var t=this.indexes[0].name,n=this.size;this.accessCount(t,function(r){if(r<=n){return}n=r-n;e.accessCursor(t,e.DB.IDBKeyRange.upperBound(Infinity),"next",function(t){if(!t.target.result||!(n--)){return}var r=t.target.result;delete e.diff[r.primaryKey];r["delete"]();r["continue"]()})})};e.prototype.loadBuffer=function(e){function n(){if(!this.result){return e&&e()}var n=this.result;t[n.primaryKey]=n.value;n["continue"]()}if(this.autoIncrement){return}var t=this.buffer;if(this.indexes.length){this.DB.IDBKeyRange&&this.accessAll(this.indexes[0].name,this.DB.IDBKeyRange.upperBound(Infinity),"prev",n)}else{this.accessAll(n)}};e.prototype.saveBuffer=function(e){var t=this;if(this.autoIncrement){return}this.accessStore(function(n){for(var r in t.diff){n.put(t.diff[r])}e&&e()})};e.prototype.getBuffers=function(){return this.buffer};e.prototype.setBuffers=function(e,t){for(var n in e){this.setBuffer(e[n],t)}return this.buffer};e.prototype.getBuffer=function(e){if(this.autoIncrement){return}return this.buffer[e]};e.prototype.setBuffer=function(e,t){if(this.autoIncrement){return}if(!e){return e}var n=e[this.keyPath];this.buffer[n]=!t?e:jQuery.extend(true,{},this.buffer[n],e);this.diff[n]=this.buffer[n];return this.buffer[n]};e.prototype.removeBuffer=function(e){if(this.autoIncrement){return}var t=this.buffer[e];delete this.buffer[e];delete this.diff[e];return t};e.prototype.clearBuffer=function(){if(this.autoIncrement){return}for(var e in this.buffer){delete this.buffer[e]}for(var e in this.diff){delete this.diff[e]}};return e}();e.Store=t})(t=e.DATA||(e.DATA={}))})(t=e.APP||(e.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){var t;(function(e){var t;(function(e){var t;(function(t){var n=function(e){function t(){e.apply(this,arguments);this.name="meta";this.keyPath="key";this.autoIncrement=false;this.size=0}__extends(t,e);return t}(e.Store);t.Meta=n})(t=e.STORE||(e.STORE={}))})(t=e.DATA||(e.DATA={}))})(t=e.APP||(e.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){var t;(function(e){var t;(function(e){var t;(function(t){var n=function(e){function t(){e.apply(this,arguments);this.name="history";this.keyPath="url";this.autoIncrement=false;this.indexes=[{name:"date",keyPath:"date",option:{unique:false}}];this.size=300}__extends(t,e);return t}(e.Store);t.History=n})(t=e.STORE||(e.STORE={}))})(t=e.DATA||(e.DATA={}))})(t=e.APP||(e.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){var t;(function(e){var t;(function(e){var t;(function(t){var n=function(e){function t(){e.apply(this,arguments);this.name="server";this.keyPath="host";this.autoIncrement=false;this.indexes=[{name:"score",keyPath:"score",option:{unique:false}}];this.size=100}__extends(t,e);return t}(e.Store);t.Server=n})(t=e.STORE||(e.STORE={}))})(t=e.DATA||(e.DATA={}))})(t=e.APP||(e.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(t){var n;(function(t){var n;(function(t){var n=function(){function n(){var n=this;this.IDBFactory=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB;this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.mozIDBKeyRange||window.msIDBKeyRange;this.name=e.DEF.NAME;this.version=10;this.refresh=10;this.upgrade=0;this.revision=0;this.state_=e.State.blank;this.stateful=new t.DB.Stateful(this,function(){return n.connect()},function(){return n.extend()});this.age=10*1e3;this.expires=0;this.timer=0;this.stores={meta:new t.STORE.Meta(this),history:new t.STORE.History(this),server:new t.STORE.Server(this)};this.meta={version:{key:"version",value:undefined},update:{key:"update",value:undefined},revision:{key:"revision",value:undefined}}}n.prototype.state=function(){return this.state_};n.prototype.extend=function(){var e=this;this.expires=(new Date).getTime()+this.age;clearTimeout(this.timer);this.timer=setTimeout(function(){return e.check()},this.age)};n.prototype.check=function(){if(!this.age||(new Date).getTime()<=this.expires){return}e.State.open===this.state()&&this.close()};n.prototype.database=function(){this.extend();return this.database_};n.prototype.configure=function(e,t){this.revision=e;this.refresh=t};n.prototype.up=function(){this.state_=e.State.blank;this.open()};n.prototype.down=function(){this.reject();this.close();this.state_=e.State.error};n.prototype.open=function(){!this.IDBFactory&&this.down();return this.stateful.open()};n.prototype.close=function(){this.database_&&this.database_.close&&this.database_.close();this.state_=e.State.close};n.prototype.resolve=function(){this.stateful.resolve()};n.prototype.reject=function(){this.stateful.reject()};n.prototype.connect=function(){this.create()};n.prototype.create=function(){var t=this;try{this.close();this.state_=e.State.initiate;var n=this.IDBFactory.open(this.name,this.upgrade?this.version:1);var r=function(){t.verify(function(){t.state_=e.State.open;t.resolve();t.extend()})};if("done"===n.readyState){this.database_=n.result;if(this.database()){r()}else{this.format()}}else{var i=setTimeout(function(){return t.down()},3e3);n.onblocked=function(){clearTimeout(i);t.database_=n.result;t.close();setTimeout(function(){return t.open()},1e3)};n.onupgradeneeded=function(){clearTimeout(i);t.database_=n.result;t.createStores()};n.onsuccess=function(){clearTimeout(i);t.database_=n.result;r()};n.onerror=function(){clearTimeout(i);t.database_=n.result;t.down()}}}catch(s){this.down()}};n.prototype.destroy=function(t,n){var r=this;try{this.close();this.state_=e.State.terminate;var i=this.IDBFactory.deleteDatabase(this.name);if(i){i.onsuccess=t;i.onerror=n}setTimeout(function(){return e.State.terminate===r.state()&&r.down()},3e3)}catch(s){this.down()}};n.prototype.format=function(){var e=this;this.destroy(function(){return e.up()},function(){return e.down()})};n.prototype.verify=function(e){var t=this;var n=this.database(),r=this.version,i=this.revision,s=this.meta,o=this.stores.meta,u=function(){return t.format()};if(n.objectStoreNames.length!==Object.keys(this.stores).length){return void u()}for(var a in this.stores){var f=n.transaction(this.stores[a].name,"readonly").objectStore(this.stores[a].name);switch(false){case f.keyPath===this.stores[a].keyPath:case f.indexNames.length===this.stores[a].indexes.length:return void u()}}var l=false;o.get(s.version.key,function(e){if(l){return}var n=e.target.result;if(!n||t.upgrade){o.set(o.setBuffer({key:s.version.key,value:r}))}else if(n.value>r){l=true;t.down()}else if(n.value<r){l=true;u()}});o.get(s.revision.key,function(e){if(l){return}var n=e.target.result;if(!n){o.set(o.setBuffer({key:s.revision.key,value:i}))}else if(n.value>i){l=true;t.down()}else if(n.value<i){l=true;u()}});o.get(s.update.key,function(n){if(l){return}var r=n.target.result;var i=Math.floor((new Date).getTime()/(24*60*60*1e3));if(!r||!t.refresh){o.set(o.setBuffer({key:s.update.key,value:i+t.refresh}));e()}else if(r.value>i){e()}else if(r.value<=i){u()}})};n.prototype.createStores=function(){this.destroyStores();var e=this.database();for(var t in this.stores){var n=this.stores[t];var r=e.createObjectStore(n.name,{keyPath:n.keyPath,autoIncrement:n.autoIncrement});for(var i=0,s=n.indexes,o;o=s[i];i++){r.createIndex(o.name,o.keyPath,o.option)}}};n.prototype.destroyStores=function(){var e=this.database();for(var t=e.objectStoreNames?e.objectStoreNames.length:0;t--;){e.deleteObjectStore(e.objectStoreNames[t])}};return n}();t.Database=n})(n=t.DATA||(t.DATA={}))})(n=t.APP||(t.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){var t;(function(e){var t;(function(e){var t=function(){function e(e){this.age_=e}e.prototype.getCookie=function(e){if(!e||!window.navigator.cookieEnabled){return}var t=new RegExp("(?:^|; )("+encodeURIComponent(e)+"=[^;]*)"),n=(document.cookie.match(t)||[]).pop();return n&&decodeURIComponent(n.split("=").pop())};e.prototype.setCookie=function(e,t,n){if(n===void 0){n={}}if(!e||!window.navigator.cookieEnabled){return}n.age=n.age||this.age_;document.cookie=[encodeURIComponent(e)+"="+encodeURIComponent(t),n.age?"; expires="+(new Date((new Date).getTime()+n.age*1e3)).toUTCString():"",n.path?"; path="+n.path:"; path=/",n.secure?"; secure":""].join("");return this.getCookie(e)};return e}();e.Cookie=t})(t=e.DATA||(e.DATA={}))})(t=e.APP||(e.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){var t;(function(e){var t;(function(e){var t=function(){function t(){this.DB=new e.Database;this.Cookie=new e.Cookie(10*24*60*60)}return t}();e.Main=t})(t=e.DATA||(e.DATA={}))})(t=e.APP||(e.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){var t=function(){function e(){}e.trim=function(e){e="string"===typeof e?e:String(0===e&&e.toString()||"");if(e.trim){e=e.trim()}else if(e=e.replace(/^[\s\uFEFF\xA0]+/,"")){var t=/[\s\uFEFF\xA0]/;var n=e.length,r=n%8;e:{while(r--){if(!t.test(e.charAt(--n))){break e}}while(n){if(!t.test(e.charAt(--n))){break e}if(!t.test(e.charAt(--n))){break e}if(!t.test(e.charAt(--n))){break e}if(!t.test(e.charAt(--n))){break e}if(!t.test(e.charAt(--n))){break e}if(!t.test(e.charAt(--n))){break e}if(!t.test(e.charAt(--n))){break e}if(!t.test(e.charAt(--n))){break e}}}e=e.substring(0,n+1)}return e};e.repeat=function(e,t){switch(e instanceof Array&&"array"||typeof e){case"string":var n=e;return Array(t+1).join(n);case"array":var r=e.length;if(t<300){var i=Array(t);this.duff(-t,function(t){return i[t]=e[t%r]})}else{var i=e.slice();while(i.length*2<=t){i=i.concat(i)}i=i.concat(i.slice(0,t-i.length))}return i}};e.fire=function(e,t,n,r){if(t===void 0){t=window}if(n===void 0){n=[]}if("function"===typeof e){return r?setTimeout(function(){e.apply(t||window,n)},0):e.apply(t||window,n)}else{return e}};e.duff=function(e,t){if(e<0){var n=-e,r=n%8;while(r--){t(--n)}while(n){t(--n);t(--n);t(--n);t(--n);t(--n);t(--n);t(--n);t(--n)}}else{var i=e,n=0,r=i%8,s=i/8^0;while(r--){t(n++)}while(s--){t(n++);t(n++);t(n++);t(n++);t(n++);t(n++);t(n++);t(n++)}}};e.duffEx=function(e,t){if(e<0){var n=-e,r=n%8;e:{while(r--){if(false===t(--n)){break e}}while(n){if(false===t(--n)){break e}if(false===t(--n)){break e}if(false===t(--n)){break e}if(false===t(--n)){break e}if(false===t(--n)){break e}if(false===t(--n)){break e}if(false===t(--n)){break e}if(false===t(--n)){break e}}}}else{var i=e,n=0,r=i%8,s=i/8^0;e:{while(r--){if(false===t(n++)){break e}}while(s--){if(false===t(n++)){break e}if(false===t(n++)){break e}if(false===t(n++)){break e}if(false===t(n++)){break e}if(false===t(n++)){break e}if(false===t(n++)){break e}if(false===t(n++)){break e}if(false===t(n++)){break e}}}}};e.normalizeUrl=function(e,t){if(t===void 0){t=true}var n;n=this.trim(e);n=/^([^:/?#]+):\/\/[^/?#.]+\.[^/?#]+/i.test(n)?n:function(e,t){t.href=e;return t.href}(n,document.createElement("a"));n=encodeURI(decodeURI(n));n=n.replace(/["`^|\\<>{}\[\]\s].*/,"");n=t?this.justifyPercentEncodingUrlCase_(e,n):n;return n};e.canonicalizeUrl=function(e){function n(e){return e.toUpperCase()}var t=this.normalizeUrl(e,false);t=t.replace(/(?:%\w{2})+/g,n);return t};e.compareUrl=function(e,t){e=this.canonicalizeUrl(e);t=this.canonicalizeUrl(t);return e===t};e.justifyPercentEncodingUrlCase_=function(e,t){function n(t){var n=~e.indexOf(t.toUpperCase())||~e.indexOf(t.toLowerCase());return n?e.substr(~n,t.length):t}return e===t?t:t.replace(/(?:%\w{2})+/g,n)};return e}();e.Utility=t})(t=e.LIBRARY||(e.LIBRARY={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(t){var n;(function(t){var n=function(){function n(n){this.model_=n;this.data_=new t.DATA.Main;this.stores_=this.data_.DB.stores;this.util_=e.LIBRARY.Utility}n.prototype.getCookie=function(e){return this.data_.Cookie.getCookie(e)};n.prototype.setCookie=function(e,t,n){return this.data_.Cookie.setCookie(e,t,n)};n.prototype.connect=function(e){if(e.database.active){this.data_.DB.configure(e.database.revision,e.database.refresh);this.data_.DB.up();this.saveTitle();this.saveScrollPosition()}else{this.data_.DB.down()}};n.prototype.loadBuffers=function(){for(var e in this.stores_){this.stores_[e].loadBuffer()}};n.prototype.saveBuffers=function(){for(var e in this.stores_){this.stores_[e].saveBuffer()}};n.prototype.getHistoryBuffer=function(e){return this.stores_.history.getBuffer(this.model_.convertUrlToKey(e,true))};n.prototype.loadTitle=function(){var e=this;var t=this.model_.convertUrlToKey(window.location.href,true);var n=this.stores_.history.getBuffer(t);if(n&&"string"===typeof n.title){document.title=n.title}else{this.stores_.history.get(t,function(r){n=r.target.result;if(n&&n.title){if(e.model_.compareKeyByUrl(t,e.util_.canonicalizeUrl(window.location.href))){document.title=n.title}}})}};n.prototype.saveTitle=function(e,t){if(e===void 0){e=window.location.href}if(t===void 0){t=document.title}var n=this.model_.convertUrlToKey(e,true);var r={url:n,title:t,date:(new Date).getTime(),scrollX:undefined,scrollY:undefined,host:undefined,expires:undefined};this.stores_.history.set(r,true);this.stores_.history.clean()};n.prototype.loadScrollPosition=function(){function r(e,t){if("number"!==typeof e||"number"!==typeof t){return}window.scrollTo(parseInt(Number(e)+"",10),parseInt(Number(t)+"",10))}var e=this;var t=this.model_.convertUrlToKey(window.location.href,true);var n=this.stores_.history.getBuffer(t);if(n&&"number"===typeof n.scrollX){r(n.scrollX,n.scrollY)}else{this.stores_.history.get(t,function(i){n=i.target.result;if(n&&"number"===typeof n.scrollX){if(e.model_.compareKeyByUrl(t,e.util_.canonicalizeUrl(window.location.href))){r(n.scrollX,n.scrollY)}}})}};n.prototype.saveScrollPosition=function(e,t,n){if(e===void 0){e=window.location.href}if(t===void 0){t=jQuery(window).scrollLeft()}if(n===void 0){n=jQuery(window).scrollTop()}var r=this.model_.convertUrlToKey(e,true);var i={url:r,scrollX:t,scrollY:n,date:(new Date).getTime(),title:undefined,host:undefined,expires:undefined};this.stores_.history.set(i,true)};n.prototype.loadExpires=function(){};n.prototype.saveExpires=function(e,t,n){var r=this.model_.convertUrlToKey(e,true);var i={url:r,host:t||"",expires:n,title:undefined,scrollX:undefined,scrollY:undefined,date:undefined};this.stores_.history.set(i,true)};n.prototype.getServerBuffers=function(){return this.stores_.server.getBuffers()};n.prototype.getServerBuffer=function(e){var t=this.model_.convertUrlToKey(e,true).split("//").pop().split("/").shift();t=this.model_.compareKeyByUrl("http://"+t,"http://"+window.location.host)?"":t;return this.stores_.server.getBuffer(t)};n.prototype.loadServer=function(){};n.prototype.saveServer=function(e,t,n,r,i){e=e.split("//").pop().split("/").shift();e=this.model_.compareKeyByUrl("http://"+e,"http://"+window.location.host)?"":e;var s={host:e,time:Math.max(n,1),score:r,state:i,expires:t};this.stores_.server.set(s,true);this.stores_.server.clean()};n.prototype.removeServer=function(e){this.stores_.server.remove(e);this.stores_.server.clean()};return n}();t.Data=n})(n=t.APP||(t.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(t){var n;(function(t){var n=function(){function t(t){this.data_=t;this.util_=e.LIBRARY.Utility;this.force_=false;this._host="";this.parallel_=4}t.prototype.host_=function(e,t){if(t){this._host=t.balance.active?this.sanitize(e,t).split("//").pop().split("/").shift()||"":""}return this._host};t.prototype.host=function(){return this.host_()};t.prototype.sanitize=function(e,t){if(!t){return""}var n;switch(e&&typeof e){case"string":n=e;break;case"object":var r=e;n=r.readyState===4&&r.getResponseHeader(t.balance.server.header)||r.host;break}n=n||"";return!/[/?#"`^|\\<>{}\[\]\s]/.test(n)&&jQuery.grep(t.balance.bounds,function(e){return""===n||"*"===e||n===e||"."===e.charAt(0)&&e===n.slice(-e.length)}).length&&n||""};t.prototype.enable=function(e){if(!e.balance.active){return void this.disable(e)}if(e.balance.client.support.browser.test(window.navigator.userAgent)){this.data_.setCookie(e.balance.client.cookie.balance,"1")}else{return void this.disable(e)}if(e.balance.client.support.redirect.test(window.navigator.userAgent)){this.data_.setCookie(e.balance.client.cookie.redirect,"1")}};t.prototype.disable=function(e){if(this.data_.getCookie(e.balance.client.cookie.balance)){this.data_.setCookie(e.balance.client.cookie.balance,"0")}if(this.data_.getCookie(e.balance.client.cookie.redirect)){this.data_.setCookie(e.balance.client.cookie.redirect,"0")}this.changeServer("",e)};t.prototype.score=function(e,t){return Math.max(Math.round(t/e*1e3),0)};t.prototype.changeServer=function(e,t){if(!t.balance.active){this.host_("",t)}else{this.host_(e,t);this.data_.setCookie(t.balance.client.cookie.host,e)}return this.host()};t.prototype.chooseServers_=function(e){function f(e,t){return+t- +e}var t=this;var n=e.balance.server.respite,r=e.balance.weight,i=e.ajax.timeout,s=e.balance.client.hosts.slice();s=this.force_?jQuery.grep(s,function(e){return!!e}):s;(function(){var n=t.data_.getCookie(e.balance.client.cookie.host);if(t.force_&&!n){return}if(n===t.sanitize(n,e)){!~jQuery.inArray(n,s)&&s.unshift(n)}else{t.data_.setCookie(e.balance.client.cookie.host,"")}})();var o=this.data_.getServerBuffers(),u={};jQuery.each(Object.keys(o),function(n,r){var i=o[r];~jQuery.inArray(i.host,s)&&s.splice(jQuery.inArray(i.host,s),1);if(t.force_&&!i.host){return}if(i.host===t.sanitize(i.host,e)&&i.expires>(new Date).getTime()){u[i.score]=i}else{t.data_.removeServer(i.host)}});var a=Object.keys(u).sort(f);var l=[],c;jQuery.each(a,function(o){var f=u[a[o]],h=f.host,p=f.time,d=f.score,v=f.state;~jQuery.inArray(h,s)&&s.splice(jQuery.inArray(h,s),1);if(v+n>=(new Date).getTime()){return}else if(v){t.data_.removeServer(f.host)}switch(true){case l.length>=e.balance.random&&0<l.length:return false;case r&&!h&&!!Math.floor(Math.random()*r):case i&&p>=i:case l.length>=Math.min(Math.floor(a.length/2),3)&&c&&p>=c.time+500&&i&&p>=i*2/3:case l.length>=Math.min(Math.floor(a.length/2),3)&&c&&d<=c.score/2:return}c=c||f;l.push(h)});while(s.length){l.push(s.splice(Math.floor(Math.random()*s.length),1).shift())}return l};t.prototype.chooseServerFromCache_=function(e){var t=this;var n=[];var r=this.data_.getHistoryBuffer(e.destLocation.href);switch(true){case!r:break;case r.host!==this.sanitize(r.host,e):this.data_.saveExpires(r.url,"",0);case!r.expires:case r.expires<(new Date).getTime():case this.force_&&!r.host:break;default:n=jQuery.map(this.data_.getServerBuffers(),function(e){if(e.host!==r.host){return}if(e.state>=(new Date).getTime()){t.data_.saveExpires(r.url,r.host,0);return}return e.host})}return n.length?n.pop()||" ":""};t.prototype.chooseServerFromScore_=function(e){var t=this.chooseServers_(e);return t.slice(Math.floor(Math.random()*Math.min(t.length,6))).shift()||" "};t.prototype.chooseServer=function(e){if(!e.balance.active){return""}return this.util_.trim(this.chooseServerFromCache_(e)||this.chooseServerFromScore_(e))};t.prototype.bypass=function(e){var t=this;this.force_=true;var n=jQuery.Deferred();if(!e||!e.balance.active){return n.reject()}var r=this.parallel_,i=this.chooseServers_(e),s=jQuery.extend({},e.ajax,e.balance.option.ajax);i=jQuery.grep(i,function(e){return!!e});var o=0,u=i.length;var a=function(r){var f=t,l=(new Date).getTime();"pending"===n.state()&&jQuery.ajax(jQuery.extend({},s,{url:f.util_.normalizeUrl(window.location.protocol+"//"+r+window.location.pathname.replace(/^\/?/,"/")+window.location.search),xhr:!e.balance.option.callbacks.ajax.xhr?undefined:function(){var t;t=f.util_.fire(e.balance.option.callbacks.ajax.xhr,this,[event,e]);t="object"===typeof t?t:jQuery.ajaxSettings.xhr();return t},beforeSend:!e.balance.option.callbacks.ajax.beforeSend&&!e.server.header?undefined:function(t,n){if(e.server.header){t.setRequestHeader(e.nss.requestHeader,"true")}if("object"===typeof e.server.header){t.setRequestHeader(e.nss.requestHeader,"true");e.server.header.area&&t.setRequestHeader(e.nss.requestHeader+"-Area",this.app_.chooseArea(e.area,document,document));e.server.header.head&&t.setRequestHeader(e.nss.requestHeader+"-Head",e.load.head);e.server.header.css&&t.setRequestHeader(e.nss.requestHeader+"-CSS",e.load.css.toString());e.server.header.script&&t.setRequestHeader(e.nss.requestHeader+"-Script",e.load.script.toString())}f.util_.fire(e.balance.option.callbacks.ajax.beforeSend,this,[event,e,t,n])},dataFilter:!e.balance.option.callbacks.ajax.dataFilter?undefined:function(t,n){return f.util_.fire(e.balance.option.callbacks.ajax.dataFilter,this,[event,e,t,n])||t},success:function(t,n,i){l=(new Date).getTime()-l;var s=f.data_.getServerBuffer(this.url),o=f.score(l,i.responseText.length);l=s&&!s.state&&s.time?Math.round((s.time+l)/2):l;o=s&&!s.state&&s.score?Math.round((s.score+o)/2):o;f.data_.saveServer(r,(new Date).getTime()+e.balance.server.expires,l,o,0);r=f.sanitize(i,e)||r;f.util_.fire(e.balance.option.ajax.success,this,arguments)},error:function(t){f.data_.saveServer(r,(new Date).getTime()+e.balance.server.expires,0,0,(new Date).getTime());r=null;f.util_.fire(e.balance.option.ajax.error,this,arguments)},complete:function(){f.util_.fire(e.balance.option.ajax.complete,this,arguments);++o;n.notify(o,u,r);if(r){f.host_(r,e);i.splice(0,i.length);n.resolve(r)}else if(!f.host()&&i.length){a(i.shift())}else{n.reject()}}}))};while(r--&&i.length){a(i.shift())}return n};return t}();t.Balancer=n})(n=t.APP||(t.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){var t;(function(e){var t=function(){function e(e,t,r,i,s,o){this.data_=e?{url:e,data:t,textStatus:r,jqXHR:i,host:s,bind:o}:{url:undefined,data:undefined,textStatus:undefined,jqXHR:undefined,host:undefined,bind:undefined};this.data=new n(this.data_)}e.prototype.state=function(e){var t=e?e.cache.expires.min:undefined,n=e?e.cache.expires.max:undefined;switch(false){case this.data.jqXHR()&&200===+this.data.jqXHR().status:case this.data.expires(t,n)>=(new Date).getTime():return false;default:return true}};return e}();e.PageRecord=t;var n=function(){function e(e){this.data_=e}e.prototype.url=function(){return this.data_.url};e.prototype.data=function(){return this.data_.data};e.prototype.textStatus=function(){return this.data_.textStatus};e.prototype.jqXHR=function(){return this.data_.jqXHR};e.prototype.bind=function(){return this.data_.bind};e.prototype.host=function(){return this.data_.host};e.prototype.expires=function(e,t){if(!this.jqXHR()&&!this.data()){return 0}var n=this.jqXHR(),r;if(n){n.timeStamp=n.timeStamp||(new Date(n.getResponseHeader("Date"))).getTime()||(new Date).getTime()}switch(true){case!n:r=0;break;case/no-store|no-cache/.test(n.getResponseHeader("Cache-Control")):r=0;break;case!!n.getResponseHeader("Cache-Control")&&!!~n.getResponseHeader("Cache-Control").indexOf("max-age="):r=(new Date(n.getResponseHeader("Date")||(new Date(n.timeStamp)).toString())).getTime()+ +n.getResponseHeader("Cache-Control").match(/max-age=(\d*)/).pop()*1e3;break;case!!n.getResponseHeader("Expires"):r=(new Date(n.getResponseHeader("Expires"))).getTime();break;default:r=0}if(undefined!==e||undefined!==t){r="number"===typeof e?Math.max(e+(new Date).getTime(),r):r;r="number"===typeof t?Math.min(t+(new Date).getTime(),r):r}r=Math.max(r,0)||0;return r};return e}();e.PageRecordData=n})(t=e.APP||(e.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){var t;(function(e){var t=function(){function e(){}e.prototype.chooseArea=function(e,t,n,r){if(r===void 0){r=true}var i=typeof e==="string"?[e]:e;e:for(var s=0;s<i.length;s++){var o=i[s],u=o.match(/(?:[^,\(\[]+|\(.*?\)|\[.*?\])+/g)||[o];for(var a=u.length;a--;){var f=u[a];switch(true){case jQuery(f,t).length===0:case jQuery(f,t).length!==jQuery(f,n).length:continue e}}return o}return""};e.prototype.dispatchEvent=function(e,t,n,r){var i=document.createEvent("HTMLEvents");i.initEvent(t,n,r);e.dispatchEvent(i)};return e}();e.PageUtility=t})(t=e.APP||(e.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(t){var n;(function(t){var n=function(){function t(t,n,r,i,s,o,u){this.model_=t;this.page_=n;this.balancer_=r;this.setting_=i;this.event_=s;this.success_=o;this.failure_=u;this.util_=e.LIBRARY.Utility;this.binds_=[];this.jsons_=[];this.main_()}t.prototype.main_=function(){function d(e,t,n){return g.call(this,[].slice.call(arguments),undefined)}function v(e,t,n){return y.apply(this,arguments)}function m(e,t){return b.apply(this,arguments)}function g(e,i,s){if(s===void 0){s=[]}if(!arguments.length||!arguments[0]){return}t.data_=e[0];t.textStatus_=e[1];t.jqXHR_=e[2];t.binds_=s.every(function(e){return!!e&&typeof e==="object"})?s:[s[2]];t.util_.fire(n.callbacks.ajax.success,this[0]||this,[r,n,t.data_,t.textStatus_,t.jqXHR_])}function y(e,i,s){if(!arguments.length||!arguments[0]){return}t.jqXHR_=e;t.textStatus_=i;t.errorThrown_=s;t.binds_=[];t.util_.fire(n.callbacks.ajax.error,this[0]||this,[r,n,t.jqXHR_,t.textStatus_,t.errorThrown_])}function b(){if(!arguments.length||!arguments[0]){return}t.util_.fire(n.callbacks.ajax.complete,this[0]||this,[r,n,t.jqXHR_,t.textStatus_]);t.model_.setPageXHR(null);t.model_.setDataXHR(null);if(200===+t.jqXHR_.status&&t.binds_.every(function(e){return 200===+e.status})){t.binds_.forEach(function(e,n){return t.binds_[n].responseJSON=t.binds_[n].responseJSON||t.jsons_[n]});t.model_.setCache(n.destLocation.href,u&&u.data||null,t.textStatus_,t.jqXHR_);t.success_(n,r,t.data_,t.textStatus_,t.jqXHR_,t.host_,t.binds_)}else{t.failure_(n,r,t.data_,t.textStatus_,t.jqXHR_,t.host_,t.binds_)}}var t=this,n=this.setting_,r=this.event_=jQuery.extend(true,{},this.event_),i=this.util_.fire(n.wait,n,[r,n,n.origLocation.cloneNode(),n.destLocation.cloneNode()]);var s=n.speedcheck,o=this.model_.speed;s&&(o.fire=r.timeStamp);s&&o.time.splice(0,100,0);s&&o.name.splice(0,100,"pjax("+o.time.slice(-1)+")");var u;switch(n.cache[r.type.toLowerCase()]&&r.type.toLowerCase()){case e.EVENT.CLICK:u=this.model_.getCache(n.destLocation.href);break;case e.EVENT.SUBMIT:u=n.cache[r.currentTarget.method.toLowerCase()]?this.model_.getCache(n.destLocation.href):u;break;case e.EVENT.POPSTATE:u=this.model_.getCache(n.destLocation.href);break}var a=this.model_.getPageXHR();if(a&&a.readyState<4&&a.location&&this.model_.comparePageByUrl(a.location.href,n.destLocation.href)){return}this.dispatchEvent(document,n.nss.event.pjax.fetch,false,false);if(u&&u.jqXHR&&200===+u.jqXHR.status){s&&o.name.splice(0,1,"cache("+o.time.slice(-1)+")");this.host_=this.model_.host();this.model_.setDataXHR(this.bind_(this.util_.fire(n.bind,n,[r,n,n.origLocation.cloneNode(),n.destLocation.cloneNode()])));a=u.jqXHR;a.location=a.location||n.destLocation.cloneNode();this.model_.setPageXHR(a);this.page_.loadtime=0;this.host_=this.balancer_.sanitize(u.host,n);this.data_=u.jqXHR.responseText;this.textStatus_=u.textStatus;this.jqXHR_=u.jqXHR;if(this.model_.isDeferrable){var f=this.wait_(i);this.page_.setWait(f);jQuery.when(jQuery.Deferred().resolve(this.data_,this.textStatus_,this.jqXHR_),f,jQuery.when.apply(null,this.model_.getDataXHR())).done(g).fail(y).always(b)}else{var l=jQuery.extend({},jQuery.ajaxSettings,n.ajax);l=l.context||l;d.call(l,this.data_,this.textStatus_,this.jqXHR_);m.call(l,this.jqXHR_,this.textStatus_)}}else if(a&&a.follow&&!~"error abort timeout parsererror".indexOf(a.statusText)){s&&o.time.splice(0,1,a.timeStamp-o.fire);s&&o.name.splice(0,1,"preload("+o.time.slice(-1)+")");s&&o.time.push(o.now()-o.fire);s&&o.name.push("continue("+o.time.slice(-1)+")");this.host_=this.model_.host();this.model_.setDataXHR(this.bind_(this.util_.fire(n.bind,n,[r,n,n.origLocation.cloneNode(),n.destLocation.cloneNode()])));a.location=n.destLocation.cloneNode();this.model_.setPageXHR(a);this.host_=this.model_.host();this.page_.loadtime=a.timeStamp;var f=this.wait_(i);this.page_.setWait(f);delete a.timeStamp;jQuery.when(a,f,jQuery.when.apply(null,this.model_.getDataXHR())).done(g).fail(y).always(b)}else{this.page_.loadtime=r.timeStamp;var c={},h={};this.host_=this.model_.host();this.model_.setDataXHR(this.bind_(this.util_.fire(n.bind,n,[r,n,n.origLocation.cloneNode(),n.destLocation.cloneNode()])));var p=this.balance_(n.destLocation.href);c.url=!n.server.query?p.href:[p.protocol,"//",p.host,p.pathname.replace(/^\/?/,"/"),p.search.replace(/&*$/,"&"+n.server.query).replace(/^\??&/,"?").replace(/(\?|&)$/,""),p.hash].join("");switch(r.type.toLowerCase()){case e.EVENT.CLICK:c.type="GET";break;case e.EVENT.SUBMIT:c.type=r.currentTarget.method.toUpperCase();switch(c.type){case"POST":if(!jQuery(r.currentTarget).has(":file").length){c.data=jQuery(r.currentTarget).serializeArray()}else if("function"===typeof FormData){c.data=(new FormData)(r.currentTarget);c.contentType=false;c.processData=false}break;case"GET":break}break;case e.EVENT.POPSTATE:c.type="GET";break}c=jQuery.extend({},n.ajax,c,{xhr:!n.callbacks.ajax.xhr?undefined:function(){var e;e=t.util_.fire(n.callbacks.ajax.xhr,this,[r,n]);e="object"===typeof e?e:jQuery.ajaxSettings.xhr();return e},beforeSend:!n.callbacks.ajax.beforeSend&&!n.server.header?undefined:function(e,i){if(n.server.header){e.setRequestHeader(n.nss.requestHeader,"true")}if("object"===typeof n.server.header){e.setRequestHeader(n.nss.requestHeader,"true");n.server.header.area&&e.setRequestHeader(n.nss.requestHeader+"-Area",this.app_.chooseArea(n.area,document,document));n.server.header.head&&e.setRequestHeader(n.nss.requestHeader+"-Head",n.load.head);n.server.header.css&&e.setRequestHeader(n.nss.requestHeader+"-CSS",n.load.css.toString());n.server.header.script&&e.setRequestHeader(n.nss.requestHeader+"-Script",n.load.script.toString())}t.util_.fire(n.callbacks.ajax.beforeSend,this,[r,n,e,i])},dataFilter:!n.callbacks.ajax.dataFilter?undefined:function(e,i){return t.util_.fire(n.callbacks.ajax.dataFilter,this,[r,n,e,i])||e},success:this.model_.isDeferrable?null:d,error:this.model_.isDeferrable?null:v,complete:this.model_.isDeferrable?null:m});a=jQuery.ajax(c);a.location=n.destLocation.cloneNode();this.model_.setPageXHR(a);if(!this.model_.isDeferrable){return}var f=this.wait_(i);this.page_.setWait(f);jQuery.when(this.model_.getPageXHR(),f,jQuery.when.apply(null,this.model_.getDataXHR())).done(g).fail(y).always(b)}};t.prototype.balance_=function(e){var t=this.setting_,n=document.createElement("a");n.href=e;n.host=this.host_||n.host;return n};t.prototype.bind_=function(e){var t=this;return(e||[]).map(function(e){e.url=t.util_.canonicalizeUrl(e.url);if(e.url.indexOf("//")>-1){return e}e.url=t.balance_(e.url).href;return e}).map(jQuery.ajax).map(function(e,n){return e.done(function(e,r,s){var o=e;switch(s.getResponseHeader("Content-Type").split("/").pop()){case"json":if(s.responseJSON){break}if(!t.jsons_[n]){t.jsons_[n]=o}else{for(var u in o){t.jsons_[n][u]=o[u]}}break}})})};t.prototype.wait_=function(e){var t=jQuery.Deferred();if(!e){return t.resolve()}setTimeout(function(){t.resolve()},e);return t};t.prototype.chooseArea=function(e,t,n){return};t.prototype.dispatchEvent=function(e,t,n,r){};return t}();t.PageFetch=n})(n=t.APP||(t.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){var t;(function(e){var t=function(){function t(t,n,r,i){this.Record_=t;this.model_=n;this.balancer_=r;this.page_=i;this.hash_=function(e){return e.nss.url};this.table_={};this.order_=[];this.fetch_=e.PageFetch}t.prototype.fetchRecord=function(e,t,n,r){if(this.getRecord(e).state(e)){this.pullRecord(e,t,n,r)}else{this.pullRecord(e,t,n,r)}};t.prototype.pullRecord=function(e,t,n,r){var i=this;new this.fetch_(this.model_,this.page_,this.balancer_,e,t,function(e,t,r,s,o,u,a){var f=i.setRecord(e,i.getRecord(e).data.data()||"",s,o,u,a);n(f,e,t)},function(e,t,n,s,o,u,a){var f=i.setRecord(e,i.getRecord(e).data.data()||"",s,o,u,a);r(f,e,t)})};t.prototype.getRecord=function(e){return this.table_[this.hash_(e)]=this.table_[this.hash_(e)]||new this.Record_};t.prototype.setRecord=function(e,t,n,r,i,s){this.cleanRecords_(e);this.addOrder_(e);return this.table_[this.hash_(e)]=new this.Record_(e.nss.url,t,n,r,i,s)};t.prototype.removeRecord=function(e){this.removeOrder_(e);return this.table_[this.hash_(e)]=new this.Record_};t.prototype.clearRecord=function(){this.order_.splice(0,this.order_.length);for(var e in this.table_){delete this.table_[e]}};t.prototype.cleanRecords_=function(e){if(e.cache.limit){while(this.order_.length>=e.cache.limit){this.removeRecord(this.order_.pop())}}};t.prototype.addOrder_=function(e){this.removeOrder_(e);this.order_.unshift(e)};t.prototype.removeOrder_=function(e){for(var t=this.order_.length;t--;){this.order_[t].nss.url===e.nss.url&&this.order_.splice(t,1)}};return t}();e.PageProvider=t})(t=e.APP||(e.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(MODULE){var MODEL;(function(MODEL){var APP;(function(APP){var PageUpdate=function(){function PageUpdate(e,t,n,r,i,s,o){this.model_=e;this.page_=t;this.data_=n;this.balancer_=r;this.setting_=i;this.event_=s;this.record_=o;this.util_=MODULE.LIBRARY.Utility;this.loadwaits_=[];this.main_()}PageUpdate.prototype.main_=function(){var e=this.record_,t=this.setting_,n=this.event_;var r=t.speedcheck,i=this.model_.speed;r&&i.time.push(i.now()-i.fire);r&&i.name.push("fetch("+i.time.slice(-1)+")");++this.page_.count;this.page_.loadtime=this.page_.loadtime&&(new Date).getTime()-this.page_.loadtime;if(t.cache.mix&&MODULE.EVENT.POPSTATE!==n.type.toLowerCase()&&(new Date).getTime()-n.timeStamp<=t.cache.mix){return this.model_.fallback(n)}try{this.page_.landing=null;if(!~(e.data.jqXHR().getResponseHeader("Content-Type")||"").toLowerCase().search(t.contentType)){throw new Error("throw: content-type mismatch")}this.srcTitle_=jQuery(e.data.jqXHR().responseText.match(/<title(?:\s.*?[^\\])?>(?:.*?[^\\])?<\/title>|$/i).pop()).text();this.dstTitle_=document.title;this.redirect_();this.blur_();this.dispatchEvent(window,t.nss.event.pjax.unload,false,false);this.url_();if(!this.model_.comparePageByUrl(t.destLocation.href,window.location.href)){throw new Error("throw: location mismatch")}this.document_()}catch(s){if(!s){return}this.model_.getCache(window.location.href)&&this.model_.removeCache(t.destLocation.href);this.model_.fallback(n)}};PageUpdate.prototype.isRegister_=function(e,t){if(e.destLocation.href===e.origLocation.href){return false}switch(t.type.toLowerCase()){case MODULE.EVENT.CLICK:case MODULE.EVENT.SUBMIT:return true;case MODULE.EVENT.POPSTATE:return false}};PageUpdate.prototype.isReplace_=function(e,t){switch(t.type.toLowerCase()){case MODULE.EVENT.CLICK:case MODULE.EVENT.SUBMIT:return jQuery(t.currentTarget).is(e.replace);case MODULE.EVENT.POPSTATE:return false}};PageUpdate.prototype.isCacheUsable_=function(e,t){switch(true){case!t.cache.click&&!t.cache.submit&&!t.cache.popstate:case MODULE.EVENT.SUBMIT===e.type.toLowerCase()&&!t.cache[e.currentTarget.method.toLowerCase()]:return false;default:return true}};PageUpdate.prototype.redirect_=function(){var e=this;var t=this.setting_,n=this.event_;var r=(jQuery('head meta[http-equiv="Refresh"][content*="URL="]').attr("content")||"").match(/(?:\d+;\s*)(.+)|$/).shift();if(!r||this.model_.comparePageByUrl(t.destLocation.href,r)){return}var i=t.destLocation.cloneNode();i.href=r;if(this.util_.fire(t.callbacks.update.redirect.before,t,[n,t,i.cloneNode(),t.origLocation.cloneNode(),t.destLocation.cloneNode()])===false){return}switch(true){case!t.redirect:case i.protocol!==t.destLocation.protocol:case i.host!==t.destLocation.host:case MODULE.EVENT.SUBMIT===n.type.toLowerCase()&&"GET"!==n.currentTarget.method.toUpperCase():switch(n.type.toLowerCase()){case MODULE.EVENT.CLICK:case MODULE.EVENT.SUBMIT:window.location.assign(i.href);break;case MODULE.EVENT.POPSTATE:window.location.replace(i.href);break}throw false;default:jQuery[MODULE.DEF.NAME].enable();switch(n.type.toLowerCase()){case MODULE.EVENT.CLICK:case MODULE.EVENT.SUBMIT:setTimeout(function(){return jQuery[MODULE.DEF.NAME].click(i.href)},0);break;case MODULE.EVENT.POPSTATE:window.history.replaceState(window.history.state,this.srcTitle_,i.href);if(this.isRegister_(t,n)&&t.fix.location&&!this.util_.compareUrl(t.destLocation.href,window.location.href)){jQuery[MODULE.DEF.NAME].disable();window.history.back();window.history.forward();jQuery[MODULE.DEF.NAME].enable()}setTimeout(function(){return e.dispatchEvent(window,MODULE.EVENT.POPSTATE,false,false)},0);break}throw false}if(this.util_.fire(t.callbacks.update.redirect.after,t,[n,t,i.cloneNode(),t.origLocation.cloneNode(),t.destLocation.cloneNode()])===false){return}};PageUpdate.prototype.blur_=function(){var e=this.setting_,t=this.event_;if(this.util_.fire(e.callbacks.update.blur.before,e,[t,e,e.origLocation.cloneNode(),e.destLocation.cloneNode()])===false){return}jQuery(document.activeElement).not("body").blur();if(this.util_.fire(e.callbacks.update.blur.after,e,[t,e,e.origLocation.cloneNode(),e.destLocation.cloneNode()])===false){return}};PageUpdate.prototype.url_=function(){var e=this.setting_,t=this.event_;this.model_.location.href=e.destLocation.href;if(this.util_.fire(e.callbacks.update.url.before,e,[t,e,e.origLocation.cloneNode(),e.destLocation.cloneNode()])===false){e.destLocation.href=this.util_.canonicalizeUrl(window.location.href);return}if(this.isReplace_(e,t)){window.history.replaceState(this.util_.fire(e.state,e,[t,e,e.origLocation.cloneNode(),e.destLocation.cloneNode()]),this.srcTitle_,e.destLocation.href);if(e.fix.location&&!this.util_.compareUrl(e.destLocation.href,window.location.href)){window.location.replace(e.destLocation.href)}}else if(this.isRegister_(e,t)){window.history.pushState(this.util_.fire(e.state,e,[t,e,e.origLocation.cloneNode(),e.destLocation.cloneNode()]),~window.navigator.userAgent.toLowerCase().indexOf("opera")?this.dstTitle_:this.srcTitle_,e.destLocation.href);if(e.fix.location&&!this.util_.compareUrl(e.destLocation.href,window.location.href)){jQuery[MODULE.DEF.NAME].disable();window.history.back();window.history.forward();jQuery[MODULE.DEF.NAME].enable()}}if(this.util_.fire(e.callbacks.update.url.after,e,[t,e,e.origLocation.cloneNode(),e.destLocation.cloneNode()])===false){e.destLocation.href=this.util_.canonicalizeUrl(window.location.href);return}};PageUpdate.prototype.document_=function(){var e=this;var t=this.setting_,n=this.event_;if(t.load.script&&!this.page_.loadedScripts[""]){var r=this.page_.loadedScripts;r[""]=true;jQuery("script").each(function(){var e=this;if(e.src){r[e.src]=!t.load.reload||!jQuery(e).is(t.load.reload)}})}this.srcDocument_=this.page_.parser.parse(this.record_.data.jqXHR().responseText,t.destLocation.href);this.dstDocument_=document;var i=t.speedcheck,s=this.model_.speed;i&&s.time.push(s.now()-s.fire);i&&s.name.push("parse("+s.time.slice(-1)+")");this.area_=this.chooseArea(t.area,this.srcDocument_,this.dstDocument_);if(!this.area_){throw new Error("throw: area notfound")}this.areas_=this.area_.match(/(?:[^,]+?|\(.*?\)|\[.*?\])+/g);this.overwriteDocumentByCache_();t.fix.noscript&&this.escapeNoscript_(this.srcDocument_);t.fix.reference&&this.fixReference_(t.origLocation.href,this.dstDocument_);this.rewrite_();this.title_();t.fix.history&&this.data_.saveTitle();this.data_.saveExpires(this.record_.data.url(),this.record_.data.host(),this.record_.data.expires());this.head_();i&&s.time.push(s.now()-s.fire);i&&s.name.push("head("+s.time.slice(-1)+")");this.content_();this.focus_();this.dispatchEvent(document,t.nss.event.pjax.DOMContentLoaded,false,false);i&&s.time.push(s.now()-s.fire);i&&s.name.push("content("+s.time.slice(-1)+")");this.balance_();this.css_('link[rel~="stylesheet"], style');jQuery(window).one(MODULE.DEF.NAME+":rendering",function(r){r.preventDefault();r.stopImmediatePropagation();var o=function(n){if(!e.model_.comparePageByUrl(t.destLocation.href,window.location.href)){return}e.dispatchEvent(document,t.nss.event.pjax.ready,false,false);jQuery(e.area_).each(function(e,t){return jQuery(t).width()});return jQuery.when?jQuery.Deferred().resolve():n()};var u=function(r){if(!e.model_.comparePageByUrl(t.destLocation.href,window.location.href)){return}e.util_.fire(t.callback,t,[n,t]);setTimeout(function(){switch(n.type.toLowerCase()){case MODULE.EVENT.CLICK:case MODULE.EVENT.SUBMIT:e.model_.overlay(t)||e.scrollByHash_(t)||e.scroll_(true);break;case MODULE.EVENT.POPSTATE:e.model_.overlay(t)||e.scroll_(true);break}},100);e.dispatchEvent(document,t.nss.event.pjax.render,false,false);i&&s.time.push(s.now()-s.fire);i&&s.name.push("render("+s.time.slice(-1)+")");return jQuery.when?jQuery.when.apply(jQuery,e.loadwaits_):r()};var a=function(){if(!e.model_.comparePageByUrl(t.destLocation.href,window.location.href)){return jQuery.when&&jQuery.Deferred().reject()}e.dispatchEvent(window,t.nss.event.pjax.load,false,false);i&&s.time.push(s.now()-s.fire);i&&s.name.push("load("+s.time.slice(-1)+")");i&&console.log(s.time);i&&console.log(s.name);e.script_("[src][defer]");return jQuery.when&&jQuery.Deferred().resolve()};e.scroll_(false);if(100>e.page_.loadtime&&t.reset.type.match(n.type.toLowerCase())&&!jQuery('form[method][method!="GET"]').length){switch(false){case e.page_.count<t.reset.count||!t.reset.count:case(new Date).getTime()<t.reset.time+e.page_.time||!t.reset.time:throw new Error("throw: reset")}}var f=e.script_(":not([defer]), :not([src])");if(jQuery.when){var l=jQuery.Deferred().pipe?"pipe":"then";jQuery.when.apply(jQuery,f)[l](function(){return o()})[l](function(){return u()})[l](function(){return a()})}else{o(function(){return u(function(){return a()})})}}).trigger(MODULE.DEF.NAME+":rendering")};PageUpdate.prototype.overwriteDocumentByCache_=function(){var e=this.setting_,t=this.event_,n=this.model_.getCache(e.destLocation.href);if(!this.isCacheUsable_(t,e)){return}if(n&&n.data){var r=e.fix.noscript?this.restoreNoscript_(n.data):n.data,i=this.page_.parser.parse(r,e.destLocation.href),s=this.srcDocument_;s.title=i.title;var o,u;for(var a=0;this.areas_[a];a++){o=jQuery(this.areas_[a],i).clone();u=jQuery(this.areas_[a],s);if(!o.length||!u.length||o.length!==u.length){throw new Error("throw: area mismatch")}for(var f=0;o[f];f++){u[f].parentNode.replaceChild(o[f],u[f])}}}};PageUpdate.prototype.rewrite_=function(){function n(e){if(!e){return{}}switch(e.getResponseHeader("Content-Type").split("/").pop()){case"json":return e.responseJSON}}var e=this.setting_,t=this.event_;if(!e.rewrite){return}if(this.util_.fire(e.callbacks.update.rewrite.before,e,[t,e,this.srcDocument_,this.dstDocument_])===false){return}this.util_.fire(e.rewrite,e,[this.srcDocument_,this.area_,this.record_.data.host(),this.record_.data.bind().map(n)]);if(this.util_.fire(e.callbacks.update.rewrite.before,e,[t,e,this.srcDocument_,this.dstDocument_])===false){return}};PageUpdate.prototype.title_=function(){var e=this.setting_,t=this.event_;if(this.util_.fire(e.callbacks.update.title.before,e,[t,e,this.srcDocument_.title,this.dstDocument_.title])===false){return}this.dstDocument_.title=this.srcDocument_.title;if(this.util_.fire(e.callbacks.update.title.after,e,[t,e,this.srcDocument_.title,this.dstDocument_.title])===false){return}};PageUpdate.prototype.head_=function(){var e=this.setting_,t=this.event_,n=this.srcDocument_,r=this.dstDocument_;if(!e.load.head){return}if(this.util_.fire(e.callbacks.update.head.before,e,[t,e,this.srcDocument_.querySelector("head"),this.dstDocument_.querySelector("head")])===false){return}var i="base, meta, link",s=jQuery(n.head).children(i).filter(e.load.head).not(e.load.ignore).not('link[rel~="stylesheet"], style, script'),o=jQuery(r.head).children(i).filter(e.load.head).not(e.load.ignore).not('link[rel~="stylesheet"], style, script'),u=jQuery(),a=o;for(var f=0,l,c;l=s[f];f++){for(var h=0;a[h];h++){if(a[h].tagName===l.tagName&&a[h].outerHTML===l.outerHTML){if(u.length){var p=o[o.index(a[h])-1];p?jQuery(p).after(u.clone()):a.eq(h).before(u.clone());u=jQuery()}a=a.not(a[h]);l=null;break}}u=u.add(l)}jQuery("title",r).before(u.clone());a.remove();if(this.util_.fire(e.callbacks.update.head.after,e,[t,e,this.srcDocument_.querySelector("head"),this.dstDocument_.querySelector("head")])===false){return}};PageUpdate.prototype.content_=function(){function f(){if(!jQuery.Deferred){return}var e=jQuery.Deferred();switch(this.tagName.toLowerCase()){case"img":jQuery(this).one("load error abort",e.resolve);break;case"iframe":case"frame":jQuery(this).one("load",e.resolve);break}return e}var e=this;var t=this.setting_,n=this.event_,r=this.srcDocument_,i=this.dstDocument_;if(this.util_.fire(t.callbacks.update.content.before,t,[n,t,jQuery(this.area_,this.srcDocument_).get(),jQuery(this.area_,this.dstDocument_).get()])===false){return}jQuery(this.area_).children("."+t.nss.elem+"-check").remove();var s,o;for(var u=0;this.areas_[u];u++){s=jQuery(this.areas_[u],r);o=jQuery(this.areas_[u],i);if(!s.length||!o.length||s.length!==o.length){throw new Error("throw: area mismatch")}s=s.map(function(e,t){return document.importNode(t,true)});s.find("script").each(function(t,n){return e.escapeScript_(n)});this.loadwaits_=this.loadwaits_.concat(s.find("img, iframe, frame").map(f).get());for(var a=0;s[a];a++){o[a].parentNode.replaceChild(s[a],o[a]);if(document.body===s[a]){jQuery.each(s[a].attributes,function(e,t){return o[a].removeAttribute(t.name)});jQuery.each(s[a].attributes,function(e,t){return o[a].setAttribute(t.name,t.value)})}}o=jQuery(this.areas_[u],i);o.find("script").each(function(t,n){return e.restoreScript_(n)})}if(this.util_.fire(t.callbacks.update.content.after,t,[n,t,jQuery(this.area_,this.srcDocument_).get(),jQuery(this.area_,this.dstDocument_).get()])===false){return}};PageUpdate.prototype.focus_=function(){var e=this.setting_,t=this.event_;if(this.util_.fire(e.callbacks.update.focus.before,e,[t,e,e.origLocation.cloneNode(),e.destLocation.cloneNode()])===false){return}jQuery("body, input[autofocus], textarea[autofocus]").last().not(document.activeElement).focus();if(this.util_.fire(e.callbacks.update.focus.after,e,[t,e,e.origLocation.cloneNode(),e.destLocation.cloneNode()])===false){return}};PageUpdate.prototype.balance_=function(){var e=this;var t=this.setting_,n=this.event_;if(!t.balance.active||this.page_.loadtime<100){return}[this.record_.data.jqXHR()].concat(this.record_.data.bind()).forEach(function(r){var i=e.balancer_.sanitize(r,t)||e.record_.data.host()||"",s=e.page_.loadtime,o=e.balancer_.score(s,r.responseText.length);if(e.util_.fire(t.callbacks.update.balance.before,t,[n,t,i,e.page_.loadtime,r.responseText.length])===false){return}var u=e.data_.getServerBuffer(t.destLocation.href),o=e.balancer_.score(s,r.responseText.length);s=u&&!u.state&&u.time?Math.round((u.time+s)/2):s;o=u&&!u.state&&u.score?Math.round((u.score+o)/2):o;e.data_.saveServer(i,(new Date).getTime()+t.balance.server.expires,s,o,0);e.balancer_.changeServer(e.balancer_.chooseServer(t),t);if(e.util_.fire(t.callbacks.update.balance.after,t,[n,t,i,e.page_.loadtime,r.responseText.length])===false){return}})};PageUpdate.prototype.css_=function(e){function l(){return jQuery.contains(r.head,this)}function c(){return jQuery.contains(r.body,this)}var t=this.setting_,n=this.event_,r=this.srcDocument_,i=this.dstDocument_;if(!t.load.css){return}var s="link, style",o=jQuery(s,r).filter(e).not(jQuery("noscript",r).find(s)),u=jQuery(s,i).filter(e).not(jQuery("noscript",r).find(s)),a=jQuery(),f=u;if(this.util_.fire(t.callbacks.update.css.before,t,[n,t,o.get(),u.get()])===false){return}o=o.not(t.load.ignore);u=o.not(t.load.ignore);for(var h=0,p;p=o[h];h++){for(var d=0,v;f[d];d++){switch(p.tagName.toLowerCase()){case"link":v=p.href===f[d].href;break;case"style":v=this.util_.trim(p.innerHTML)===this.util_.trim(f[d].innerHTML);break}if(v){if(a.length){if(jQuery.contains(i.body,f[d])&&a.first().parents("head").length){jQuery(i.head).append(a.filter(l).clone());f.eq(d).before(a.filter(c).clone())}else{var m=u[u.index(f[d])-1];m?jQuery(m).after(a.clone()):f.eq(d).before(a.clone())}a=jQuery()}f=f.not(f[d]);d-=Number(!!d);p=null;break}}a=a.add(p)}jQuery(i.head).append(a.filter(l).clone());jQuery(i.body).append(a.filter(c).clone());f.remove();u=jQuery(s,i).filter(e).not(jQuery("noscript",r).find(s));if(this.util_.fire(t.callbacks.update.css.after,t,[n,t,o.get(),u.get()])===false){return}var g=t.speedcheck,y=this.model_.speed;g&&y.time.push(y.now()-y.fire);g&&y.name.push("css("+y.time.slice(-1)+")")};PageUpdate.prototype.script_=function(selector){var _this=this;var setting=this.setting_,event=this.event_,srcDocument=this.srcDocument_,dstDocument=this.dstDocument_;var scriptwaits=[],scripts=[];if(!setting.load.script){return scriptwaits}var prefilter="script",$srcElements=jQuery(prefilter,srcDocument).filter(selector).not(jQuery("noscript",srcDocument).find(prefilter)),$dstElements=jQuery(prefilter,dstDocument).filter(selector).not(jQuery("noscript",dstDocument).find(prefilter)),loadedScripts=this.page_.loadedScripts,regType=/^$|(?:application|text)\/(?:java|ecma)script/i,regRemove=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;if(this.util_.fire(setting.callbacks.update.script.before,setting,[event,setting,$srcElements.get(),$dstElements.get()])===false){return scriptwaits}$srcElements=$srcElements.not(setting.load.ignore);var exec=function(element,response){if(!_this.model_.comparePageByUrl(setting.destLocation.href,window.location.href)){return false}if(element.src){loadedScripts[element.src]=!setting.load.reload||!jQuery(element).is(setting.load.reload)}try{if(_this.model_.isDeferrable){if("string"===typeof response){eval.call(window,response)}else{throw response}}else{if(element.hasAttribute("src")){jQuery.ajax(jQuery.extend(true,{},setting.ajax,setting.load.ajax,{url:element.src,dataType:"script",async:false,global:false,success:function(){return null},error:function(e){throw e}}))}else{eval.call(window,(element.text||element.textContent||element.innerHTML||"").replace(regRemove,""))}}try{element.hasAttribute("src")&&_this.dispatchEvent(element,"load",false,false)}catch(e){}}catch(err){try{element.hasAttribute("src")&&_this.dispatchEvent(element,"error",false,false)}catch(e){}if(true===setting.load.error){throw err}else{_this.util_.fire(setting.load.error,setting,[err,element])}}};for(var i=0,element;element=$srcElements[i];i++){if(!regType.test(element.type||"")){continue}if(element.hasAttribute("src")?loadedScripts[element.src]:!this.util_.trim(element.innerHTML)){continue}e:{var srcLogParent=jQuery(element).parent(setting.load.log)[0];if(!srcLogParent||jQuery(element).parents(this.area_).length){break e}var dstLogParent=jQuery(srcLogParent.id||srcLogParent.tagName,dstDocument)[0],log=element.cloneNode(true);this.escapeScript_(log);dstLogParent.appendChild(log);this.restoreScript_(log)}(function(e){var t=_this.model_.isDeferrable&&jQuery.Deferred();if(e.hasAttribute("src")&&e.getAttribute("src")){loadedScripts[e.src]=!setting.load.reload||!jQuery(e).is(setting.load.reload);if(e.hasAttribute("async")){jQuery.ajax(jQuery.extend({},setting.ajax,setting.load.ajax,{url:e.src,dataType:"script",async:true,global:false,success:function(){return _this.dispatchEvent(e,"load",false,false)},error:function(){return _this.dispatchEvent(e,"error",false,false)}}))}else{if(t){jQuery.ajax(jQuery.extend({},setting.ajax,setting.load.ajax,{url:e.src,dataType:"text",async:true,global:false,success:function(n){return t.resolve([e,n])},error:function(n){return t.resolve([e,n])}}));scriptwaits.push(t)}else{scripts.push(e)}}}else if(!e.hasAttribute("src")){if(t){scriptwaits.push(t.resolve([e,(e.text||e.textContent||e.innerHTML||"").replace(regRemove,"")]))}else{scripts.push(e)}}})(element)}try{if(this.model_.isDeferrable){jQuery.when.apply(jQuery,scriptwaits).always(function(){var e=[];for(var t=0;t<arguments.length;t++){e[t-0]=arguments[t]}return jQuery.each(e,function(e,t){return exec.apply(_this,t)})})}else{jQuery.each(scripts,function(e,t){return exec(t)})}}catch(err){setTimeout(function(){return _this.model_.fallback(event)},1);throw err}$dstElements=jQuery(prefilter,dstDocument).filter(selector).not(jQuery("noscript",dstDocument).find(prefilter));if(this.util_.fire(setting.callbacks.update.script.after,setting,[event,setting,$srcElements.get(),$dstElements.get()])===false){return scriptwaits}var speedcheck=setting.speedcheck,speed=this.model_.speed;speedcheck&&speed.time.push(speed.now()-speed.fire);speedcheck&&speed.name.push("script("+speed.time.slice(-1)+")");return scriptwaits};PageUpdate.prototype.scroll_=function(e){var t=this.setting_,n=this.event_;if(this.util_.fire(t.callbacks.update.scroll.before,t,[n,t])===false){return}var r,i;switch(n.type.toLowerCase()){case MODULE.EVENT.CLICK:case MODULE.EVENT.SUBMIT:r=e&&"function"===typeof t.scrollLeft?this.util_.fire(t.scrollLeft,t,[n,t,t.origLocation.cloneNode(),t.destLocation.cloneNode()]):t.scrollLeft;r=0<=r?r:0;r=r===false||r===null?jQuery(window).scrollLeft():parseInt(Number(r)+"",10);i=e&&"function"===typeof t.scrollTop?this.util_.fire(t.scrollTop,t,[n,t,t.origLocation.cloneNode(),t.destLocation.cloneNode()]):t.scrollTop;i=0<=i?i:0;i=i===false||i===null?jQuery(window).scrollTop():parseInt(Number(i)+"",10);window.scrollTo(r,i);break;case MODULE.EVENT.POPSTATE:e&&t.fix.scroll&&this.data_.loadScrollPosition();break}e&&this.data_.saveScrollPosition();if(this.util_.fire(t.callbacks.update.scroll.after,t,[n,t])===false){return}};PageUpdate.prototype.scrollByHash_=function(e){var t=e.destLocation.hash.replace(/^#/,"");if(!t){return false}var n=jQuery("#"+t+", [name~="+t+"]").first();if(n.length){isFinite(n.offset().top)&&window.scrollTo(jQuery(window).scrollLeft(),parseInt(Number(n.offset().top)+"",10));this.data_.saveScrollPosition();return true}else{return false}};PageUpdate.prototype.fixReference_=function(e,t){function f(e,t){var n;switch(true){case"href"in t:n="href";break;case"src"in t:n="src";break;default:return}switch(a){case 0:break;case 1:t[n]=u+t.getAttribute(n);break;case-1:t[n]=t.getAttribute(n).replace(u,"");break}t.setAttribute(n,t[n].replace(o,"/"))}var n=e.replace(/[^/]+$/,""),r=t.URL.replace(/[^/]+$/,""),i=n.split("/").length,s=r.split("/").length;var o=/^.+?\w\//;var u=this.util_.repeat("../",Math.abs(i-s)),a;switch(true){case i===s:a=0;break;case i<s:a=1;break;case i>s:a=-1;break}jQuery("[href], [src]",t).not(['[href^="/"]','[href^= "http:"]','[href^= "https:"]','[src^= "/"]','[src^= "http:"]','[src^= "https:"]'].join(",")).each(f)};PageUpdate.prototype.escapeNoscript_=function(e){function t(){jQuery(this).text(this.innerHTML)}jQuery("noscript",e).children().parent().each(t)};PageUpdate.prototype.restoreNoscript_=function(e){var t=jQuery("<span/>");return e.replace(/(<noscript>)([^<>]+?)(<\/noscript>)/gim,function(e,n,r,i){return n+t.html(r).text()+i})};PageUpdate.prototype.escapeScript_=function(e){jQuery.data(e,"source",e.src);jQuery.data(e,"code",e.innerHTML);e.removeAttribute("src");e.innerHTML=""};PageUpdate.prototype.restoreScript_=function(e){if(undefined===jQuery.data(e,"code")){return}e.innerHTML=" ";if(jQuery.data(e,"source")){e.src=jQuery.data(e,"source");jQuery.removeData(e,"source")}else{e.removeAttribute("src")}e.innerHTML=jQuery.data(e,"code");jQuery.removeData(e,"code")};PageUpdate.prototype.chooseArea=function(e,t,n){return};PageUpdate.prototype.dispatchEvent=function(e,t,n,r){};return PageUpdate}();APP.PageUpdate=PageUpdate})(APP=MODEL.APP||(MODEL.APP={}))})(MODEL=MODULE.MODEL||(MODULE.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(t){var n;(function(t){var n=function(){function t(){this.util_=e.LIBRARY.Utility;this.sandbox_cache_={}}t.prototype.sandbox_=function(e){var t=this;if(e===void 0){e=window.location.href}e=this.util_.canonicalizeUrl(e).split("#").shift();if(!this.sandbox_cache_[e]||"object"!==typeof this.sandbox_cache_[e].document||this.sandbox_cache_[e].document.URL!==e){jQuery('<iframe srcdoc="<!DOCTYPE html>" sandbox="allow-same-origin"></iframe>').appendTo("body").each(function(n,r){t.sandbox_cache_[e]=r["contentWindow"];t.sandbox_cache_[e].document.open();t.sandbox_cache_[e].document.close()}).remove()}return this.sandbox_cache_[e]};t.prototype.test_=function(e){try{var t='<html lang="en" class="html"><head><title>&amp;</title><link href="/"><noscript><style>/**/</style></noscript></head><body><noscript>noscript</noscript><a href="/"></a></body></html>',n=this.parse(t,window.location.href,e);switch(false){case!!n:case n.URL&&decodeURI(n.URL)===decodeURI(window.location.href):case n.title==="&":case!!n.querySelector('html.html[lang="en"]'):case!!n.querySelector("head>link")["href"]:case!!n.querySelector("head>noscript")["innerHTML"]:case!!n.querySelector("body>noscript")["innerHTML"]:case!!n.querySelector("body>a")["href"]:throw true}return e}catch(r){}};t.prototype.parse=function(e,t,n){function i(e,t){var n=document.createElement("div");n.innerHTML=t.match(/<html(?:\s.*?[^\\])?>|$/i).shift().replace(/html/i,"div")||"<div>";var r=n.firstChild.attributes;for(var i=0,s;s=r[i];i++){e.documentElement.setAttribute(s.name,s.value)}var n=document.createElement("html");n.innerHTML=t.replace(/^.*?<html(?:\s.*?[^\\])?>/im,"");e.documentElement.removeChild(e.head);e.documentElement.removeChild(e.body);while(n.childNodes.length){e.documentElement.appendChild(n.childNodes[0])}return e}if(t===void 0){t=""}if(n===void 0){n=this.mode_}e+=~e.search(/<title[\s>]/i)?"":"<title></title>";var r;switch(n){case"dom":r=(new window.DOMParser).parseFromString(e,"text/html");break;case"doc":r=document.implementation.createHTMLDocument("");if("object"!==typeof r.activeElement||!r.activeElement){break}if("function"===typeof window.DOMParser){r.title=(new window.DOMParser).parseFromString(e.match(/<title(?:\s.*?[^\\])?>(?:.*?[^\\])?<\/title>|$/i),"text/html").title}r.open();r.write(e);r.close();if(r.title!==r.querySelector("title").textContent){r.title=r.querySelector("title").textContent}break;case"manipulate":r=i(document.implementation.createHTMLDocument(""),e);break;case null:r=null;break;default:switch(/webkit|firefox|trident|$/i.exec(window.navigator.userAgent).shift().toLowerCase()){case"webkit":this.mode_=this.test_("doc")||this.test_("dom")||this.test_("manipulate");break;case"firefox":this.mode_=this.test_("dom")||this.test_("doc")||this.test_("manipulate");break;case"trident":this.mode_=this.test_("manipulate")||this.test_("dom")||this.test_("doc");break;default:this.mode_=this.test_("dom")||this.test_("doc")||this.test_("manipulate")}r=this.mode_&&this.parse(e,t);break}return r};return t}();t.PageParser=n;var r=function(){function e(){e.instance_=e.instance_||new n}e.prototype.singleton_=function(){return e.instance_};e.prototype.parse=function(e,t){return this.singleton_().parse(e,t)};return e}();t.PageParserSingleton=r})(n=t.APP||(t.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(t){var n;(function(t){e.MIXIN(t.PageFetch,[t.PageUtility]);e.MIXIN(t.PageUpdate,[t.PageUtility]);var n=function(){function n(n,r,i){var s=this;this.model_=n;this.data_=r;this.balancer_=i;this.util_=e.LIBRARY.Utility;this.parser=new t.PageParserSingleton;this.provider=new t.PageProvider(t.PageRecord,this.model_,this.balancer_,this);this.landing=this.util_.normalizeUrl(window.location.href);this.loadedScripts={};this.dataXHR=[];this.loadtime=0;this.count=0;this.time=(new Date).getTime();setTimeout(function(){return s.parser.parse("")||s.model_.disable()},100)}n.prototype.transfer=function(t,n){switch(n.type.toLowerCase()){case e.EVENT.CLICK:this.data_.saveTitle();this.data_.saveScrollPosition();break;case e.EVENT.SUBMIT:this.data_.saveTitle();this.data_.saveScrollPosition();break;case e.EVENT.POPSTATE:this.data_.saveTitle(t.origLocation.href,document.title);t.fix.history&&this.data_.loadTitle();break}t=jQuery.extend(true,{},t);t.origLocation=t.origLocation.cloneNode();t.destLocation=t.destLocation.cloneNode();t=e.FREEZE(t);this.fetch_(t,n)};n.prototype.getWait=function(){return this.wait_};n.prototype.setWait=function(e){this.wait_&&this.wait_.state&&"pending"===this.wait_.state()&&this.wait_.reject();return this.wait_=e};n.prototype.fetch_=function(e,t){var n=this;this.provider.fetchRecord(e,t,function(e,t,r){return n.success_(e,t,r)},function(e,t,r){return n.failure_(e,t,r)})};n.prototype.success_=function(e,n,r){new t.PageUpdate(this.model_,this,this.data_,this.balancer_,n,r,e)};n.prototype.failure_=function(e,t,n){var r=this;if(!t.fallback||"abort"===e.data.textStatus()){return}this.data_.saveExpires(t.destLocation.href,"",0);if(t.balance.active){this.data_.saveServer(e.data.host(),(new Date).getTime()+t.balance.server.expires,0,0,(new Date).getTime());this.balancer_.changeServer(this.balancer_.chooseServer(t),t)}setTimeout(function(){return r.model_.fallback(n)},100)};n.prototype.chooseArea=function(e,t,n){return};n.prototype.dispatchEvent=function(e,t,n,r){};return n}();t.Page=n})(n=t.APP||(t.APP={}))})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(MODULE){var MODEL;(function(MODEL){var APP;(function(APP){MODULE.MIXIN(APP.Page,[APP.PageUtility]);var Main=function(){function Main(e,t){this.model_=e;this.controller_=t;this.util_=MODULE.LIBRARY.Utility;this.settings_={};this.data=new APP.Data(this.model_);this.balancer=new APP.Balancer(this.data);this.page=new APP.Page(this.model_,this.data,this.balancer)}Main.prototype.initialize=function(e,t){var n=this;this.controller_.view(e,t);this.balancer.enable(t);this.balancer.changeServer(this.balancer.chooseServer(t),t);this.data.loadBuffers();setTimeout(function(){return n.page.landing=null},1500)};Main.prototype.configure=function(destination){var _this=this;var event=destination.preventDefault?destination:null;switch(event&&"object"===typeof event&&event.type.toLowerCase()){case MODULE.EVENT.CLICK:return this.configure(event.currentTarget);case MODULE.EVENT.SUBMIT:return this.configure(event.currentTarget);case MODULE.EVENT.POPSTATE:return this.configure(window.location);case null:break}var url;switch(true){case"string"===typeof destination:url=destination;break;case"href"in destination&&typeof destination.href==="string":url=this.util_.normalizeUrl(destination.href);break;case"href"in destination&&typeof destination.href==="object":url=this.util_.normalizeUrl(destination.href["baseVal"]);break;case"action"in destination:url=this.util_.normalizeUrl(destination.action.replace(/[?#].*/,""));switch(destination.method.toUpperCase()){case"GET":url+="?"+jQuery(destination).serialize();break}break;default:url=this.model_.location.href;this.option_=destination}var index=[this.util_.canonicalizeUrl(this.model_.location.href).slice(0,2048),this.util_.canonicalizeUrl(url).slice(0,2048)].join(" ");if(!this.option_){return null}if(index in this.settings_){return this.settings_[index]}var origLocation=this.model_.location.cloneNode(),destLocation=this.model_.location.cloneNode();origLocation.href=this.util_.canonicalizeUrl(origLocation.href);destLocation.href=this.util_.canonicalizeUrl(url);var scope=this.scope_(this.option_,origLocation.href,destLocation.href)||null;var initial={area:"body",link:"a:not([target])",filter:function(){var e=document.createElement("a");e.href=typeof this.href==="string"?this.href:this.href.baseVal;return/^https?:/.test(e.href)&&/\/[^.]*$|\.(html?|php)$/.test(e.pathname.replace(/^\/?/,"/"))},form:null,replace:null,bind:null,rewrite:null,scope:null,state:null,scrollTop:0,scrollLeft:0,ajax:{dataType:"text"},contentType:"text/html",redirect:true,cache:{click:false,submit:false,popstate:false,get:true,post:true,mix:0,limit:100,expires:{max:null,min:5*60*1e3}},buffer:{limit:30,delay:500},load:{head:"",css:false,script:false,ignore:'[src*="jquery.js"], [src*="jquery.min.js"], [href^="chrome-extension://"]',reload:"",log:"head, body",error:true,ajax:{dataType:"script",cache:true}},balance:{active:false,bounds:["*"],weight:1,random:0,option:{server:{header:false},ajax:{crossDomain:true},callbacks:{ajax:{beforeSend:null}}},client:{hosts:[],support:{browser:/msie|trident.+ rv:|chrome|firefox|safari/i,redirect:/chrome|firefox|safari/i},cookie:{balance:"balanceable",redirect:"redirectable",host:"host"}},server:{header:"X-Ajax-Host",respite:10*60*1e3,expires:10*24*60*60*1e3}},wait:0,fallback:true,reset:{type:"",count:100,time:3*60*60*1e3},fix:{location:true,history:true,scroll:true,noscript:true,reference:true},database:{active:true,revision:0,refresh:10},server:{query:null,header:true},overlay:"",callback:null,callbacks:{ajax:{},update:{redirect:{},blur:{},url:{},rewrite:{},title:{},head:{},content:{},focus:{},scroll:{},css:{},script:{},balance:{}}},data:undefined},force={uid:MODULE.UUID(),ns:"",nss:undefined,speedcheck:undefined,origLocation:origLocation,destLocation:destLocation,scroll:{queue:[]},option:this.option_},compute=function(){setting.ns=setting.ns?setting.ns.split(".").sort().join("."):"";var nsArray=[MODULE.DEF.NAME].concat(setting.ns?setting.ns.split("."):[]);var query=setting.server.query;switch(query&&typeof query){case"string":query=eval("({"+query.toString().match(/[^?=&]+=[^&]*/g).join("&").replace(/"/g,'\\"').replace(/([^?=&]+)=([^&]*)/g,'"$1": "$2"').replace(/&/g,",")+"})");case"object":query=jQuery.param(query);break;default:query=""}return{uid:undefined,ns:undefined,origLocation:undefined,destLocation:undefined,scroll:undefined,option:undefined,speedcheck:undefined,nss:{array:nsArray,name:nsArray.join("."),data:nsArray[0],url:_this.model_.convertUrlToKey(setting.destLocation.href,true),event:{pjax:{fetch:[MODULE.EVENT.PJAX,"fetch"].join(":"),unload:[MODULE.EVENT.PJAX,"unload"].join(":"),DOMContentLoaded:[MODULE.EVENT.PJAX,"DOMContentLoaded"].join(":"),ready:[MODULE.EVENT.PJAX,"ready"].join(":"),render:[MODULE.EVENT.PJAX,"render"].join(":"),load:[MODULE.EVENT.PJAX,"load"].join(":")},click:[MODULE.EVENT.CLICK].concat(nsArray.join(":")).join("."),submit:[MODULE.EVENT.SUBMIT].concat(nsArray.join(":")).join("."),popstate:[MODULE.EVENT.POPSTATE].concat(nsArray.join(":")).join("."),scroll:[MODULE.EVENT.SCROLL].concat(nsArray.join(":")).join(".")},elem:nsArray.join("-"),requestHeader:["X",nsArray[0].replace(/^\w/,function(e){return e.toUpperCase()})].join("-")},fix:/android|iphone os|like mac os x/i.test(window.navigator.userAgent)?undefined:{location:false},contentType:setting.contentType.replace(/\s*[,;]\s*/g,"|").toLowerCase(),database:{refresh:Math.min(setting.database.refresh,30)},reset:{type:(setting.reset.type||"").toLowerCase()},server:{query:query},timeStamp:(new Date).getTime()}};var setting;setting=jQuery.extend(true,initial,scope||this.option_);setting=jQuery.extend(true,setting,setting.balance.active&&setting.balance.option,force);setting=jQuery.extend(true,setting,compute());if(scope){MODULE.FREEZE(setting,true);this.settings_[index]=setting;return setting}else{this.settings_[index]=null;return null}};Main.prototype.scope_=function(e,t,n){e=jQuery.extend(true,{},e);if(!e.scope){return e}var r,i,s=e.scope,o,u,a,f,l;r=this.model_.convertUrlToKey(t,true).match(/.+?\w(\/.*)/).pop();i=this.model_.convertUrlToKey(n,true).match(/.+?\w(\/.*)/).pop();u=r.split("/");for(var c=u.length;c--;){a=u.slice(0,c+1).join("/");a=a+("/"===r.charAt(a.length)?"/":"");if(!a||!(a in s)){continue}var h;if(s[a]instanceof Array){f="";h=s[a]}else{f=s[a];h=s[f]}if(h){h=h.concat()}else{continue}var p,d,v,m=[];v=l=p=d=undefined;for(var g=0,y;y=h[g];g++){if("#"===y.charAt(0)){if(!~jQuery.inArray(y,m)&&y.length>1){m.push(y);f=y.slice(1);[].splice.apply(h,[g,1].concat(s[f],"#"));y=h[g]}else{f="";continue}}if("inherit"===y){v=true}else if("string"===typeof y){var b="!"===y.charAt(0);y=b?y.slice(1):y;var w="*"===y.charAt(0);y=w?y.slice(1):y;if(w?~r.search(y):~r.indexOf(y)){if(b){p=false}else{p=true;l=s["$"+f]||s["$"+y]||undefined}}if(w?~i.search(y):~i.indexOf(y)){if(b){d=false}else{d=true;l=s["$"+f]||s["$"+y]||undefined}}}if(false===p||false===d){return null}}if(p&&d){return jQuery.extend(true,e,l)}else if(v){continue}break}return undefined};return Main}();APP.Main=Main})(APP=MODEL.APP||(MODEL.APP={}))})(MODEL=MODULE.MODEL||(MODULE.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(e){e.App=e.APP.Main})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this,e.State.initiate);this.controller_=(new e.Controller(this)).singleton();this.app_=new t.App(this,this.controller_);this.util_=e.LIBRARY.Utility;this.isDeferrable=!!jQuery.when&&"1.006"<=jQuery().jquery.match(/\d[\d.]+\d/).pop().replace(/\.(\d+)/g,".00$1").replace(/0*(\d{3})/g,"$1");this.location=document.createElement("a");this.queue_=[]}__extends(r,n);r.prototype.host=function(){return this.app_.balancer.host()};r.prototype.state=function(){return this.state_};r.prototype.main_=function(t,n){var r=this;switch(typeof n){case"object":t=t instanceof e.DEF.NAMESPACE?t:jQuery(document)[e.DEF.NAME]();e.FREEZE(n,true);break;default:return t}if(!window.history||!window.history["pushState"]||!window.history["replaceState"]){return t}this.location.href=this.util_.normalizeUrl(window.location.href);var i=this.app_.configure(n);if(!i){return t}this.app_.data.connect(i);this.speed={fire:0,time:[],name:[],now:function(){return(new Date).getTime()}};jQuery(function(){r.app_.initialize(t,i);r.state_=r.state()===e.State.initiate?e.State.open:r.state();r.overlay(i,true)});return t};r.prototype.convertUrlToKey=function(e,t){e=t?this.util_.canonicalizeUrl(e):e;return this.util_.trim(e).split("#").shift()};r.prototype.compareKeyByUrl=function(e,t){e=this.convertUrlToKey(e,true);t=this.convertUrlToKey(t,true);return e===t};r.prototype.comparePageByUrl=function(e,t){e=this.convertUrlToKey(e,true);t=this.convertUrlToKey(t,true);return e===t};r.prototype.configure=function(e){return this.app_.configure(e)};r.prototype.isOperatable=function(t){if(e.State.open!==this.state()){return false}if(t.which>1||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey){return false}var n;switch(t.type.toLowerCase()){case e.EVENT.CLICK:n=this.app_.configure(t.currentTarget);if(n&&!jQuery(t.currentTarget).filter(n.filter).length){return false}break;case e.EVENT.SUBMIT:n=this.app_.configure(t.currentTarget);break;case e.EVENT.POPSTATE:n=this.app_.configure(window.location);break}if(!n){return false}if(n.origLocation.protocol!==n.destLocation.protocol||n.origLocation.host!==n.destLocation.host){return false}switch(t.type.toLowerCase()){case e.EVENT.CLICK:if(this.comparePageByUrl(n.origLocation.href,n.destLocation.href)&&n.destLocation.hash){return false}break;case e.EVENT.SUBMIT:break;case e.EVENT.POPSTATE:if(this.comparePageByUrl(n.origLocation.href,n.destLocation.href)){return false}break}if(!this.app_.page.chooseArea(n.area,document,document)){return false}return true};r.prototype.getPageXHR=function(){return this.app_.page.pageXHR};r.prototype.setPageXHR=function(e){this.app_.page.pageXHR&&this.app_.page.pageXHR.readyState<4&&this.app_.page.pageXHR!==e&&this.app_.page.pageXHR.abort();return this.app_.page.pageXHR=e};r.prototype.getDataXHR=function(){return this.app_.page.dataXHR};r.prototype.setDataXHR=function(e){function n(n){switch(true){case n>=t.length:case t[n].readyState===4:case t.indexOf(e[n])>-1:return e[n]}t[n].abort();return e[n]}e=e||[];var t=this.app_.page.dataXHR;return this.app_.page.dataXHR=Array.apply(null,Array(Math.max(e.length,this.app_.page.dataXHR.length))).map(function(e,t){return n(t)}).filter(function(e){return!!e})};r.prototype.click=function(t){t.timeStamp=(new Date).getTime();var n=t.currentTarget,r=jQuery(n);var i=this.app_.configure(n);this.location.href=this.util_.normalizeUrl(window.location.href);switch(true){case!i:case t.isDefaultPrevented():case this.state()!==e.State.open:break;case this.isOperatable(t):this.app_.page.transfer(i,t);t.preventDefault();break;case this.isHashChange(i)&&this.overlay(i):t.preventDefault();window.history.pushState(null,document.title,i.destLocation.href);break;case!t.originalEvent&&!jQuery(document).has(n).length:this.fallback(t);break}};r.prototype.submit=function(t){t.timeStamp=(new Date).getTime();var n=t.currentTarget,r=jQuery(n);var i=this.app_.configure(n);this.location.href=this.util_.normalizeUrl(window.location.href);switch(true){case!i:case t.isDefaultPrevented():case this.state()!==e.State.open:break;case this.isOperatable(t):this.app_.page.transfer(i,t);t.preventDefault();break;case!t.originalEvent&&!jQuery(document).has(n).length:this.fallback(t);break}};r.prototype.popstate=function(t){if(this.app_.page.landing&&this.util_.compareUrl(this.app_.page.landing,window.location.href)){return}t.timeStamp=(new Date).getTime();var n=this.app_.configure(window.location);switch(true){case!n:!this.comparePageByUrl(this.location.href,window.location.href)&&this.fallback(t);break;case this.state()!==e.State.open:break;case this.isOperatable(t):this.app_.page.transfer(n,t);break;case this.isHashChange(n)&&this.overlay(n):break;case!this.comparePageByUrl(n.origLocation.href,window.location.href):this.fallback(t);break}this.location.href=this.util_.normalizeUrl(window.location.href)};r.prototype.scroll=function(e,t){var n=this;var r;while(r=this.queue_.shift()){clearTimeout(r)}r=setTimeout(function(){while(r=n.queue_.shift()){clearTimeout(r)}n.compareKeyByUrl(window.location.href,n.location.href)&&n.app_.data.saveScrollPosition()},300);this.queue_.push(r)};r.prototype.fallback=function(e){var t=this.configure(e);switch(true){case t&&!t.fallback:case t&&false===this.util_.fire(t.fallback,t,[e,t,t.origLocation.cloneNode(),t.destLocation.cloneNode()]):break;default:this.movePageNormally_(e)}};r.prototype.movePageNormally_=function(t){switch(t.type.toLowerCase()){case e.EVENT.CLICK:if(typeof t.currentTarget.href==="string"){window.location.assign(t.currentTarget.href)}else{window.location.assign(t.currentTarget.href["baseVal"])}break;case e.EVENT.SUBMIT:switch(t.currentTarget.method.toUpperCase()){case"GET":window.location.assign(t.currentTarget.action.replace(/[?#].*/,"")+"?"+jQuery(t.currentTarget).serialize());break;case"POST":window.location.assign(t.currentTarget.action);break}break;case e.EVENT.POPSTATE:window.location.reload();break}};r.prototype.isHashChange=function(e){return!!e&&e.origLocation.href.replace(/#.*/,"")===e.destLocation.href.replace(/#.*/,"")&&e.origLocation.hash!==e.destLocation.hash};r.prototype.overlay=function(e,t){var n=this;var r=e.destLocation.hash.replace(/^#/,"");if(!r||!e.overlay){return false}var i=jQuery("#"+r+", [name~="+r+"]");i=i.add(i.nextUntil(":header"));i=i.filter(e.overlay).add(i.find(e.overlay)).first();if(!i.length){return false}if(this.isHashChange(e)){this.app_.data.loadScrollPosition();setTimeout(function(){return n.app_.data.loadScrollPosition()},1)}var s=jQuery("<div>");i=i.clone(true);s.addClass(e.nss.elem+"-overlay").css({background:"rgba(255, 255, 255, 0.8)",display:"none",position:"fixed",top:0,left:0,right:0,bottom:0,margin:0,padding:0,border:"none"}).append(i.css({position:"absolute",top:0,left:0,right:0,bottom:0,margin:"auto"}).show());s.bind("click",s,function(e){if(e.target!==e.currentTarget){return}window.history.pushState(window.history.state,document.title,window.location.href.replace(/#.*/,""));n.location.href=n.util_.normalizeUrl(window.location.href);jQuery(e.data).fadeOut("fast",function(){return jQuery(e.data).remove()})});s.appendTo("body").fadeIn(t?0:100);jQuery(window).one("popstate",s,function(e){setTimeout(function(){return n.app_.data.loadScrollPosition()},1);jQuery(e.data).fadeOut("fast",function(){return jQuery(e.data).remove()})});/trident/i.test(window.navigator.userAgent)&&i.width(i.width());this.app_.data.saveScrollPosition();return true};r.prototype.enable=function(){this.state_=e.State.open};r.prototype.disable=function(){this.state_=e.State.pause};r.prototype.getCache=function(e){var t=this.configure(this.convertUrlToKey(e));if(!t){return}var n=this.app_.page.provider.getRecord(t);return n.state(t)||n.data.data()?{data:n.data.data(),textStatus:n.data.textStatus(),jqXHR:n.data.jqXHR(),expires:n.data.expires(),host:n.data.host()}:void this.removeCache(e)};r.prototype.setCache=function(e,t,n,r){var i=this.configure(this.convertUrlToKey(e));if(!i){return}var s=this.app_.page.provider.getRecord(i);this.app_.page.provider.setRecord(i,t||"",n||s.data.textStatus(),r||s.data.jqXHR(),this.app_.balancer.sanitize(r,i)||s.data.host()||"",null)};r.prototype.removeCache=function(e){var t=this.configure(this.convertUrlToKey(e));if(!t){return}this.app_.page.provider.removeRecord(t)};r.prototype.clearCache=function(){this.app_.page.provider.clearRecord()};r.prototype.bypass=function(){return this.app_.balancer.bypass(this.app_.configure(window.location))};return r}(t.Template);t.Main=n;var r=function(){function e(){e.instance_=e.instance_||new n}e.singleton=function(){return e.instance_};e.prototype.singleton=function(){return e.singleton()};return e}();t.Singleton=r})(t=e.MODEL||(e.MODEL={}))})(MODULE||(MODULE={}));var MODULE;(function(e){e.Model=e.MODEL.Singleton})(MODULE||(MODULE={}));var Module=function(){function e(){new MODULE.Model}return e}();new Module}(window,window.document,void 0,jQuery))