(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1},y=[].slice,b=function(e,t){return function(){return e.apply(t,arguments)}},w={}.hasOwnProperty;e=jQuery;n=function(e,t,n){var r,i,s,o;e+="";i=e.split(".");s=i[0];o=i.length>1?n+i[1]:"";r=/(\d+)(\d{3})/;while(r.test(s)){s=s.replace(r,"$1"+t+"$2")}return s+o};l=function(t){var r;r={digitsAfterDecimal:0,scaler:1,thousandsSep:",",decimalSep:".",prefix:"",suffix:"",showZero:false};t=e.extend(r,t);return function(e){var r;if(isNaN(e)||!isFinite(e)){return""}if(e===0&&!t.showZero){return""}r=n((t.scaler*e).toFixed(t.digitsAfterDecimal),t.thousandsSep,t.decimalSep);return""+t.prefix+r+t.suffix}};p=l();d=l({digitsAfterDecimal:0});v=l({digitsAfterDecimal:1,scaler:100,suffix:"%"});r={count:function(e){if(e==null){e=d}return function(){return function(t,n,r){return{count:0,push:function(){return this.count++},value:function(){return this.count},format:e}}}},countUnique:function(e){if(e==null){e=d}return function(t){var n;n=t[0];return function(t,r,i){return{uniq:[],push:function(e){var t;if(t=e[n],g.call(this.uniq,t)<0){return this.uniq.push(e[n])}},value:function(){return this.uniq.length},format:e,numInputs:1}}}},listUnique:function(e){return function(t){var n;n=t[0];return function(t,r,i){return{uniq:[],push:function(e){var t;if(t=e[n],g.call(this.uniq,t)<0){return this.uniq.push(e[n])}},value:function(){return this.uniq.join(e)},format:function(e){return e},numInputs:1}}}},sum:function(e){if(e==null){e=p}return function(t){var n;n=t[0];return function(t,r,i){return{sum:0,push:function(e){if(!isNaN(parseFloat(e[n]))){return this.sum+=parseFloat(e[n])}},value:function(){return this.sum},format:e,numInputs:1}}}},average:function(e){if(e==null){e=p}return function(t){var n;n=t[0];return function(t,r,i){return{sum:0,len:0,push:function(e){if(!isNaN(parseFloat(e[n]))){this.sum+=parseFloat(e[n]);return this.len++}},value:function(){return this.sum/this.len},format:e,numInputs:1}}}},sumOverSum:function(e){if(e==null){e=p}return function(t){var n,r;r=t[0],n=t[1];return function(t,i,s){return{sumNum:0,sumDenom:0,push:function(e){if(!isNaN(parseFloat(e[r]))){this.sumNum+=parseFloat(e[r])}if(!isNaN(parseFloat(e[n]))){return this.sumDenom+=parseFloat(e[n])}},value:function(){return this.sumNum/this.sumDenom},format:e,numInputs:2}}}},sumOverSumBound80:function(e,t){if(e==null){e=true}if(t==null){t=p}return function(n){var r,i;i=n[0],r=n[1];return function(n,s,o){return{sumNum:0,sumDenom:0,push:function(e){if(!isNaN(parseFloat(e[i]))){this.sumNum+=parseFloat(e[i])}if(!isNaN(parseFloat(e[r]))){return this.sumDenom+=parseFloat(e[r])}},value:function(){var t;t=e?1:-1;return(.821187207574908/this.sumDenom+this.sumNum/this.sumDenom+1.2815515655446004*t*Math.sqrt(.410593603787454/(this.sumDenom*this.sumDenom)+this.sumNum*(1-this.sumNum/this.sumDenom)/(this.sumDenom*this.sumDenom)))/(1+1.642374415149816/this.sumDenom)},format:t,numInputs:2}}}},fractionOf:function(e,t,n){if(t==null){t="total"}if(n==null){n=v}return function(){var r;r=1<=arguments.length?y.call(arguments,0):[];return function(i,s,o){return{selector:{total:[[],[]],row:[s,[]],col:[[],o]}[t],inner:e.apply(null,r)(i,s,o),push:function(e){return this.inner.push(e)},format:n,value:function(){return this.inner.value()/i.getAggregator.apply(i,this.selector).inner.value()},numInputs:e.apply(null,r)().numInputs}}}}};i=function(e){return{Count:e.count(d),"Count Unique Values":e.countUnique(d),"List Unique Values":e.listUnique(", "),Sum:e.sum(p),"Integer Sum":e.sum(d),Average:e.average(p),"Sum over Sum":e.sumOverSum(p),"80% Upper Bound":e.sumOverSumBound80(true,p),"80% Lower Bound":e.sumOverSumBound80(false,p),"Sum as Fraction of Total":e.fractionOf(e.sum(),"total",v),"Sum as Fraction of Rows":e.fractionOf(e.sum(),"row",v),"Sum as Fraction of Columns":e.fractionOf(e.sum(),"col",v),"Count as Fraction of Total":e.fractionOf(e.count(),"total",v),"Count as Fraction of Rows":e.fractionOf(e.count(),"row",v),"Count as Fraction of Columns":e.fractionOf(e.count(),"col",v)}}(r);h={Table:function(e,t){return c(e,t)},"Table Barchart":function(t,n){return e(c(t,n)).barchart()},Heatmap:function(t,n){return e(c(t,n)).heatmap()},"Row Heatmap":function(t,n){return e(c(t,n)).heatmap("rowheatmap")},"Col Heatmap":function(t,n){return e(c(t,n)).heatmap("colheatmap")}};u={en:{aggregators:i,renderers:h,localeStrings:{renderError:"An error occurred rendering the PivotTable results.",computeError:"An error occurred computing the PivotTable results.",uiRenderError:"An error occurred rendering the PivotTable UI.",selectAll:"Select All",selectNone:"Select None",tooMany:"(too many to list)",filterResults:"Filter results",totals:"Totals",vs:"vs",by:"by"}}};a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];m=function(e){return("0"+e).substr(-2,2)};o={bin:function(e,t){return function(n){return n[e]-n[e]%t}},dateFormat:function(e,t,n,r){if(n==null){n=a}if(r==null){r=s}return function(i){var s;s=new Date(Date.parse(i[e]));if(isNaN(s)){return""}return t.replace(/%(.)/g,function(e,t){switch(t){case"y":return s.getFullYear();case"m":return m(s.getMonth()+1);case"n":return n[s.getMonth()];case"d":return m(s.getDate());case"w":return r[s.getDay()];case"x":return s.getDay();case"H":return m(s.getHours());case"M":return m(s.getMinutes());case"S":return m(s.getSeconds());default:return"%"+t}})}}};f=function(e){return function(e,t){var n,r,i,s,o,u,a;u=/(\d+)|(\D+)/g;o=/\d/;a=/^0/;if(typeof e==="number"||typeof t==="number"){if(isNaN(e)){return 1}if(isNaN(t)){return-1}return e-t}n=String(e).toLowerCase();i=String(t).toLowerCase();if(n===i){return 0}if(!(o.test(n)&&o.test(i))){return n>i?1:-1}n=n.match(u);i=i.match(u);while(n.length&&i.length){r=n.shift();s=i.shift();if(r!==s){if(o.test(r)&&o.test(s)){return r.replace(a,".0")-s.replace(a,".0")}else{return r>s?1:-1}}}return n.length-i.length}}(this);e.pivotUtilities={aggregatorTemplates:r,aggregators:i,renderers:h,derivers:o,locales:u,naturalSort:f,numberFormat:l};t=function(){function t(e,n){this.getAggregator=b(this.getAggregator,this);this.getRowKeys=b(this.getRowKeys,this);this.getColKeys=b(this.getColKeys,this);this.sortKeys=b(this.sortKeys,this);this.arrSort=b(this.arrSort,this);this.natSort=b(this.natSort,this);this.aggregator=n.aggregator;this.aggregatorName=n.aggregatorName;this.colAttrs=n.cols;this.rowAttrs=n.rows;this.valAttrs=n.vals;this.pivotId=n.pivotId;this.pivotContainerId=n.pivotContainerId;this.tree={};this.rowKeys=[];this.colKeys=[];this.rowTotals={};this.colTotals={};this.allTotal=this.aggregator(this,[],[]);this.sorted=false;t.forEachRecord(e,n.derivedAttributes,function(e){return function(t){if(n.filter(t)){return e.processRecord(t)}}}(this))}t.forEachRecord=function(t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v;if(e.isEmptyObject(n)){i=r}else{i=function(e){var t,i,s;for(t in n){i=n[t];e[t]=(s=i(e))!=null?s:e[t]}return r(e)}}if(e.isFunction(t)){return t(i)}else if(e.isArray(t)){if(e.isArray(t[0])){d=[];for(o in t){if(!w.call(t,o))continue;s=t[o];if(!(o>0)){continue}f={};p=t[0];for(u in p){if(!w.call(p,u))continue;a=p[u];f[a]=s[u]}d.push(i(f))}return d}else{v=[];for(c=0,h=t.length;c<h;c++){f=t[c];v.push(i(f))}return v}}else if(t instanceof jQuery){l=[];e("thead > tr > th",t).each(function(t){return l.push(e(this).text())});return e("tbody > tr",t).each(function(t){f={};e("td",this).each(function(t){return f[l[t]]=e(this).text()});return i(f)})}else{throw new Error("unknown input format")}};t.convertToArray=function(e){var n;n=[];t.forEachRecord(e,{},function(e){return n.push(e)});return n};t.prototype.natSort=function(e,t){return f(e,t)};t.prototype.arrSort=function(e,t){return this.natSort(e.join(),t.join())};t.prototype.sortKeys=function(){if(!this.sorted){this.rowKeys.sort(this.arrSort);this.colKeys.sort(this.arrSort)}return this.sorted=true};t.prototype.getColKeys=function(){this.sortKeys();return this.colKeys};t.prototype.getRowKeys=function(){this.sortKeys();return this.rowKeys};t.prototype.processRecord=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;t=[];i=[];l=this.colAttrs;for(o=0,a=l.length;o<a;o++){s=l[o];t.push((c=e[s])!=null?c:"null")}h=this.rowAttrs;for(u=0,f=h.length;u<f;u++){s=h[u];i.push((p=e[s])!=null?p:"null")}r=i.join(String.fromCharCode(0));n=t.join(String.fromCharCode(0));this.allTotal.push(e);if(i.length!==0){if(!this.rowTotals[r]){this.rowKeys.push(i);this.rowTotals[r]=this.aggregator(this,i,[])}this.rowTotals[r].push(e)}if(t.length!==0){if(!this.colTotals[n]){this.colKeys.push(t);this.colTotals[n]=this.aggregator(this,[],t)}this.colTotals[n].push(e)}if(t.length!==0&&i.length!==0){if(!this.tree[r]){this.tree[r]={}}if(!this.tree[r][n]){this.tree[r][n]=this.aggregator(this,i,t)}return this.tree[r][n].push(e)}};t.prototype.getAggregator=function(e,t){var n,r,i;i=e.join(String.fromCharCode(0));r=t.join(String.fromCharCode(0));if(e.length===0&&t.length===0){n=this.allTotal}else if(e.length===0){n=this.colTotals[r]}else if(t.length===0){n=this.rowTotals[i]}else{n=this.tree[i][r]}return n!=null?n:{value:function(){return null},format:function(){return""}}};return t}();c=function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,E,S,x,T;a={localeStrings:{totals:"Totals"}};n=e.extend(a,n);s=t.colAttrs;p=t.rowAttrs;v=t.getRowKeys();u=t.getColKeys();h=document.createElement("table");h.className="pvtTable";m=function(e,t,n){var r,i,s,o,u,a;if(t!==0){i=true;for(o=u=0;0<=n?u<=n:u>=n;o=0<=n?++u:--u){if(e[t-1][o]!==e[t][o]){i=false}}if(i){return-1}}r=0;while(t+r<e.length){s=false;for(o=a=0;0<=n?a<=n:a>=n;o=0<=n?++a:--a){if(e[t][o]!==e[t+r][o]){s=true}}if(s){break}r++}return r};for(l in s){if(!w.call(s,l))continue;i=s[l];E=document.createElement("tr");if(parseInt(l)===0&&p.length!==0){y=document.createElement("th");y.setAttribute("colspan",p.length);y.setAttribute("rowspan",s.length);E.appendChild(y)}y=document.createElement("th");y.className="pvtAxisLabel";y.textContent=i;E.appendChild(y);for(f in u){if(!w.call(u,f))continue;o=u[f];T=m(u,parseInt(f),parseInt(l));if(T!==-1){y=document.createElement("th");y.className="pvtColLabel";y.textContent=o[l];y.setAttribute("colspan",T);if(parseInt(l)===s.length-1&&p.length!==0){y.setAttribute("rowspan",2)}E.appendChild(y)}}if(parseInt(l)===0){y=document.createElement("th");y.className="pvtTotalLabel";y.innerHTML=n.localeStrings.totals;y.setAttribute("rowspan",s.length+(p.length===0?0:1));E.appendChild(y)}h.appendChild(E)}if(p.length!==0){E=document.createElement("tr");for(f in p){if(!w.call(p,f))continue;c=p[f];y=document.createElement("th");y.className="pvtAxisLabel";y.textContent=c;E.appendChild(y)}y=document.createElement("th");if(s.length===0){y.className="pvtTotalLabel";y.innerHTML=n.localeStrings.totals}E.appendChild(y);h.appendChild(E)}for(f in v){if(!w.call(v,f))continue;d=v[f];E=document.createElement("tr");for(l in d){if(!w.call(d,l))continue;S=d[l];T=m(v,parseInt(f),parseInt(l));if(T!==-1){y=document.createElement("th");y.className="pvtRowLabel";y.textContent=S;y.setAttribute("rowspan",T);if(parseInt(l)===p.length-1&&s.length!==0){y.setAttribute("colspan",2)}E.appendChild(y)}}for(l in u){if(!w.call(u,l))continue;o=u[l];r=t.getAggregator(d,o);x=r.value();g=document.createElement("td");g.className="pvtVal row"+f+" col"+l;g.innerHTML=r.format(x);g.setAttribute("data-value",x);E.appendChild(g)}b=t.getAggregator(d,[]);x=b.value();g=document.createElement("td");g.className="pvtTotal rowTotal";g.innerHTML=b.format(x);g.setAttribute("data-value",x);g.setAttribute("data-for","row"+f);E.appendChild(g);h.appendChild(E)}E=document.createElement("tr");y=document.createElement("th");y.className="pvtTotalLabel";y.innerHTML=n.localeStrings.totals;y.setAttribute("colspan",p.length+(s.length===0?0:1));E.appendChild(y);for(l in u){if(!w.call(u,l))continue;o=u[l];b=t.getAggregator([],o);x=b.value();g=document.createElement("td");g.className="pvtTotal colTotal";g.innerHTML=b.format(x);g.setAttribute("data-value",x);g.setAttribute("data-for","col"+l);E.appendChild(g)}b=t.getAggregator([],[]);x=b.value();g=document.createElement("td");g.className="pvtGrandTotal";g.innerHTML=b.format(x);g.setAttribute("data-value",x);E.appendChild(g);h.appendChild(E);h.setAttribute("data-numrows",v.length);h.setAttribute("data-numcols",u.length);return h};e.fn.pivot=function(n,i){var s,o,a,f,l;s={cols:[],rows:[],filter:function(){return true},aggregator:r.count()(),aggregatorName:"Count",derivedAttributes:{},renderer:c,rendererOptions:null,localeStrings:u.en.localeStrings};i=e.extend(s,i);f=null;try{a=new t(n,i);try{f=i.renderer(a,i.rendererOptions)}catch(h){o=h;if(typeof console!=="undefined"&&console!==null){console.error(o.stack)}f=e("<span>").html(i.localeStrings.renderError)}}catch(h){o=h;if(typeof console!=="undefined"&&console!==null){console.error(o.stack)}f=e("<span>").html(i.localeStrings.computeError)}l=this[0];while(l.hasChildNodes()){l.removeChild(l.lastChild)}return this.append(f)};e.fn.pivotUI=function(n,r,i,s){var o,a,l,c,h,p,d,v,m,y,b,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,J,K,Q;if(i==null){i=false}if(s==null){s="fr"}d={derivedAttributes:{},aggregators:u[s].aggregators,renderers:u[s].renderers,hiddenAttributes:[],menuLimit:200,cols:[],rows:[],vals:[],exclusions:{},unusedAttrsVertical:"auto",autoSortUnusedAttrs:false,rendererOptions:{localeStrings:u[s].localeStrings},onRefresh:null,filter:function(){return true},localeStrings:u[s].localeStrings};m=this.data("pivotUIOptions");if(m==null||i){S=e.extend(d,r)}else{S=m}try{n=t.convertToArray(n);A=function(){var e,t;e=n[0];t=[];for(E in e){if(!w.call(e,E))continue;t.push(E)}return t}();X=S.derivedAttributes;for(h in X){if(!w.call(X,h))continue;if(g.call(A,h)<0){A.push(h)}}c={};for(j=0,R=A.length;j<R;j++){H=A[j];c[H]={}}t.forEachRecord(n,S.derivedAttributes,function(e){var t,n,r;r=[];for(E in e){if(!w.call(e,E))continue;t=e[E];if(!S.filter(e)){continue}if(t==null){t="null"}if((n=c[E])[t]==null){n[t]=0}r.push(c[E][t]++)}return r});_=e("<table cellpadding='1'>");k=e("<td>");C=e("<div class='pvtRenderer  radioboxbg my2Columns' >").appendTo(k).bind("change",function(){return T()});V=S.renderers;var G=0;for(H in V){if(!w.call(V,H))continue;var Y=e("<li class='pvtRendererUnliststyle '> </li>").appendTo(C);if(G==0){e("<input type='radio' name='renderChoice' checked='checked'  class='pvtRenderermyRadiostyle'>").val(H).html("").appendTo(Y)}else{e("<input type='radio' name='renderChoice'  class='pvtRenderermyRadiostyle'>").val(H).html("").appendTo(Y)}e("<label for="+H+" class='labelClass' data-toggle='tooltip'  title="+H+">").val(H).html(H).appendTo(Y);G++}p=e("<td class='pvtAxisContainer pvtUnused'>");L=function(){var e,t,n;n=[];for(e=0,t=A.length;e<t;e++){h=A[e];if(g.call(S.hiddenAttributes,h)<0){n.push(h)}}return n}();P=false;if(S.unusedAttrsVertical==="auto"){l=0;for(F=0,U=L.length;F<U;F++){o=L[F];l+=o.length}P=l>120}if(S.unusedAttrsVertical===true||P){p.addClass("pvtVertList")}else{p.addClass("pvtHorizList")}B=function(t){var n,r,i,s,o,u,a,l,h,d,v,m,b,w,x;a=function(){var e;e=[];for(E in c[t]){e.push(E)}return e}();u=false;m=e("<div>").addClass("pvtFilterBox").hide();m.append(e("<h4>").text(""+t+" ("+a.length+")"));if(a.length>S.menuLimit){m.append(e("<p>").html(S.localeStrings.tooMany))}else{r=e("<p>").appendTo(m);r.append(e("<button>").html(S.localeStrings.selectAll).bind("click",function(){return m.find("input").prop("checked",true)}));r.append(e("<button>").html(S.localeStrings.selectNone).bind("click",function(){return m.find("input").prop("checked",false)}));r.append(e("<input>").addClass("pvtSearch").attr("placeholder",S.localeStrings.filterResults).bind("keyup",function(){var t;t=e(this).val().toLowerCase();return e(this).parents(".pvtFilterBox").find("label span").each(function(){var n;n=this.innerText.toLowerCase().indexOf(t);if(n!==-1){return e(this).parent().show()}else{return e(this).parent().hide()}})}));updateFilterbefore=function(){var t;t=e(m).find("[type='checkbox']").length-e(m).find("[type='checkbox']:checked").length;if(t>0){n.addClass("pvtFilteredAttribute")}else{n.removeClass("pvtFilteredAttribute")}if(a.length>S.menuLimit){return m.toggle()}else{return m.toggle(0,T)}};r.append(e("<button>").text("OK").bind("click",updateFilterbefore));i=e("<div>").addClass("pvtCheckContainer").appendTo(m);x=a.sort(f);for(b=0,w=x.length;b<w;b++){E=x[b];v=c[t][E];s=e("<label>");o=S.exclusions[t]?g.call(S.exclusions[t],E)>=0:false;u||(u=o);e("<input type='checkbox' class='pvtFilter'>").attr("checked",!o).data("filter",[t,E]).appendTo(s);s.append(e("<span>").text(""+E+" ("+v+")"));i.append(e("<p>").append(s))}}d=function(){var t;t=e(m).find("[type='checkbox']").length-e(m).find("[type='checkbox']:checked").length;if(t>0){n.addClass("pvtFilteredAttribute")}else{n.removeClass("pvtFilteredAttribute")}if(a.length>S.menuLimit){return m.toggle()}else{return m.toggle(0,T)}};e("<p>").appendTo(m).append(e("<button>").text("OK").bind("click",d));l=function(t){m.css({align:"center"}).toggle();e(".pvtSearch").val("");return e("label").show()};h=e("<span class='pvtTriangle'>").html("&#x25BE;").bind("click",l);n=e("<li class='axis_"+y+"'>").append(e("<span class='pvtAttr'>").text(t).data("attrName",t).append(h));if(u){n.addClass("pvtFilteredAttribute")}p.append(n).append(m);return n.bind("dblclick",l)};for(y in L){if(L.hasOwnProperty(y)){h=L[y];B(h)}}O=e("<tr>").appendTo(_);a=e("<select class='pvtAggregator'>").bind("change",function(){return T()});J=S.aggregators;for(H in J){if(J.hasOwnProperty(H)){if(!w.call(J,H))continue;a.append(e("<option>").val(H).html(H))}}e("<td class='pvtVals'>").appendTo(O).append(a).append(e("<br>"));e("<td class='pvtAxisContainer pvtHorizList pvtCols'>").appendTo(O);M=e("<tr>").appendTo(_);M.append(e("<td valign='top' class='pvtAxisContainer pvtRows'>"));x=e("<td valign='top' class='pvtRendererArea'>").appendTo(M);if(S.unusedAttrsVertical===true||P){_.find("tr:nth-child(1)").prepend(k);_.find("tr:nth-child(2)").prepend(p)}else{_.prepend(e("<tr>").append(k).append(p))}this.html(_);K=S.cols;for(I=0,z=K.length;I<z;I++){H=K[I];this.find(".pvtCols").append(this.find(".axis_"+L.indexOf(H)))}Q=S.rows;for(q=0,W=Q.length;q<W;q++){H=Q[q];this.find(".pvtRows").append(this.find(".axis_"+L.indexOf(H)))}if(S.aggregatorName!=null){this.find(".pvtAggregator").val(S.aggregatorName)}if(S.rendererName!=null){this.find(".pvtRenderer").val(S.rendererName)}b=true;N=function(t){return function(){var r,i,s,o,u,f,l,c,h,p,d,v,m,w,N,k;c={derivedAttributes:S.derivedAttributes,localeStrings:S.localeStrings,rendererOptions:S.rendererOptions,cols:[],rows:[]};u=(k=S.aggregators[a.val()]([])().numInputs)!=null?k:0;p=[];t.find(".pvtRows li span.pvtAttr").each(function(){return c.rows.push(e(this).data("attrName"))});t.find(".pvtCols li span.pvtAttr").each(function(){return c.cols.push(e(this).data("attrName"))});t.find(".pvtVals select.pvtAttrDropdown").each(function(){if(u===0){return e(this).remove()}else{u--;if(e(this).val()!==""){return p.push(e(this).val())}}});if(u!==0){l=t.find(".pvtVals");for(H=w=0;0<=u?w<u:w>u;H=0<=u?++w:--w){o=e("<select class='pvtAttrDropdown'>").append(e("<option>")).bind("change",function(){return T()});for(N=0,m=L.length;N<m;N++){r=L[N];o.append(e("<option>").val(r).text(r))}l.append(o)}}d=S.pivotId;v=S.pivotContainerId;if(b){p=S.vals;y=0;t.find(".pvtVals select.pvtAttrDropdown").each(function(){e(this).val(p[y]);return y++});b=false}c.aggregatorName=a.val();c.vals=p;c.pivotId=d;c.pivotContainerId=v;c.aggregator=S.aggregators[a.val()](p);var A=e("input:radio[name='renderChoice']:checked").val();c.renderer=S.renderers[A];i={};t.find("input.pvtFilter").not(":checked").each(function(){var t;t=e(this).data("filter");if(i[t[0]]!=null){return i[t[0]].push(t[1])}else{return i[t[0]]=[t[1]]}});c.filter=function(e){var t,n;if(!S.filter(e)){return false}for(E in i){if(i.hasOwnProperty(E)){t=i[E];if(n=""+e[E],g.call(t,n)>=0){return false}}}return true};x.pivot(n,c);f=e.extend(S,{cols:c.cols,rows:c.rows,pivotId:d,pivotContainerId:v,vals:p,exclusions:i,aggregatorName:a.val(),rendererName:C.val()});t.data("pivotUIOptions",f);if(S.autoSortUnusedAttrs){s=e.pivotUtilities.naturalSort;h=t.find("td.pvtUnused.pvtAxisContainer");e(h).children("li").sort(function(t,n){return s(e(t).text(),e(n).text())}).appendTo(h)}x.css("opacity",1);if(S.onRefresh!=null){return S.onRefresh(f)}}}(this);T=function(e){return function(){x.css("opacity",.5);return setTimeout(N,10)}}(this);T();this.find(".pvtAxisContainer").sortable({update:function(e,t){if(t.sender==null){return T()}},connectWith:this.find(".pvtAxisContainer"),items:"li",placeholder:"pvtPlaceholder"})}catch(Z){v=Z;if(typeof console!=="undefined"&&console!==null){console.error(v.stack)}this.html(S.localeStrings.uiRenderError)}return this};e.fn.heatmap=function(t){var n,r,i,s,o,u,a,f;if(t==null){t="heatmap"}u=this.data("numrows");o=this.data("numcols");n=function(e,t,n){var r;r=function(){switch(e){case"red":return function(e){return"ff"+e+e};case"green":return function(e){return""+e+"ff"+e};case"blue":return function(e){return""+e+e+"ff"}}}();return function(e){var i,s;s=255-Math.round(255*(e-t)/(n-t));i=s.toString(16).split(".")[0];if(i.length===1){i=0+i}return r(i)}};r=function(t){return function(r,i){var s,o,u;o=function(n){return t.find(r).each(function(){var t;t=e(this).data("value");if(t!=null&&isFinite(t)){return n(t,e(this))}})};u=[];o(function(e){return u.push(e)});s=n(i,Math.min.apply(Math,u),Math.max.apply(Math,u));return o(function(e,t){return t.css("background-color","#"+s(e))})}}(this);switch(t){case"heatmap":r(".pvtVal","red");break;case"rowheatmap":for(i=a=0;0<=u?a<u:a>u;i=0<=u?++a:--a){r(".pvtVal.row"+i,"red")}break;case"colheatmap":for(s=f=0;0<=o?f<o:f>o;s=0<=o?++f:--f){r(".pvtVal.col"+s,"red")}}r(".pvtTotal.rowTotal","red");r(".pvtTotal.colTotal","red");return this};e.fn.barchart=function(){var t,n,r,i,s;i=this.data("numrows");r=this.data("numcols");t=function(t){return function(n){var r,i,s,o;r=function(r){return t.find(n).each(function(){var t;t=e(this).data("value");if(t!=null&&isFinite(t)){return r(t,e(this))}})};o=[];r(function(e){return o.push(e)});i=Math.max.apply(Math,o);s=function(e){return 100*e/(1.4*i)};return r(function(t,n){var r,i;r=n.text();i=e("<div>").css({position:"relative",height:"55px"});i.append(e("<div>").css({position:"absolute",bottom:0,left:0,right:0,height:s(t)+"%","background-color":"gray"}));i.append(e("<div>").text(r).css({position:"relative","padding-left":"5px","padding-right":"5px"}));return n.css({padding:0,"padding-top":"5px","text-align":"center"}).html(i)})}}(this);for(n=s=0;0<=i?s<i:s>i;n=0<=i?++s:--s){t(".pvtVal.row"+n)}t(".pvtTotal.colTotal");return this}}).call(this)